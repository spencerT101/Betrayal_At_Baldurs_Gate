(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[116,"STLCloseupCarouselCommon"],{"/vtw":function(e,t,n){n.d(t,"a",(function(){return a}));var i=n("26Ai"),r=n("lPMS");function a(e,t=r.o){return Object(i.a)().then(n=>{const i=new n(document.createElement("div")),r=e.filter(e=>"localImage"===e.type).map(e=>e.src);return i.setImages(r).then(()=>({media:i.getCanvasOutput({width:t}),canvasJson:i.toJSON()}))})}},"03SQ":function(e,t,n){n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return _})),n.d(t,"a",(function(){return I}));var i=n("iru6"),r=n("Ye/N"),a=n("7w6Q"),o=n("8nxc"),s=n("2AUE"),d=n("IIK6"),c=n("9KEC"),l=n("WPUZ"),u=n("D2+t"),p=n("RjJ5"),m=n("M8j6"),f=n("i+W5"),b=n("ZQVr");function h(e,t){return(n,i)=>{const a=i(),{pinbuilder:{storyPinItemBlocks:o,storyPinItems:s}}=a;if(s[t]&&s[t].blockIds.length){const a=s[t].blockIds.find(e=>"story_pin_video_block"===o[e].type),d=a?o[a].media:null;if(a&&d&&"localVideo"===d.type&&d.signature&&void 0!==d.trimmedEndTime&&void 0!==d.trimmedStartTime&&(0!==d.trimmedStartTime||d.trimmedEndTime!==d.duration)){const{signature:o,trimmedEndTime:s,trimmedStartTime:c}=d;n(Object(m.setPinBuilderPinItemUploadStatus)(e,t,"uploadingEdit")),n(Object(l.f)(e,a,{signature:null})),Object(b.f)(o,"video-story-pin",{time_start:Object(p.c)(c),time_end:Object(p.c)(s)},{onStartEdits:t=>n(Object(l.f)(e,a,{uploadId:t}))}).then(r=>{const o=i(),{pinbuilder:s}=o,{pinDraftIdUploadStatusMap:d}=s;n(Object(l.f)(e,a,{signature:r.signature})),n(Object(m.setPinBuilderPinItemUploadStatus)(e,t,"completed"));const c=Object.keys(d[e].items).filter(t=>d[e].items[t].status.startsWith("uploading")||d[e].items[t].status.startsWith("queue"));(0===c.length||1===c.length&&c[0]===t)&&"queueCreate"===d[e].status&&(n(Object(f.f)({pinDraftId:e})),n(Object(m.removePinBuilderPinDraftUpload)(e)))}).catch(()=>{n(Object(f.A)(e,r.a._("Video edit upload failed","pinbuilder.upload.video.edit.error","Error message for setting the edit values for video"))),n(Object(f.L)(e,"attempted")),n(Object(l.f)(e,a,{signature:o})),n(Object(m.setPinBuilderPinItemUploadStatus)(e,t,"queueEdit"))})}}}}function _(e,t){return(n,i)=>{const p=i(),{pinbuilder:_}=p,{pinDrafts:I,pinDraftIds:g,pinItems:y,storyPinItemBlocks:O,storyPinItems:P}=_,{pinItemIds:E,status:v,type:j}=I[e],S="story"===j,{media:D}=S?P[t]:y[t],T=o.a.enabled("storyPinExpressive"),w=S?E.findIndex(e=>e===t):void 0,A=T&&P[t]&&P[t].blockIds.length?P[t].blockIds.find(e=>"story_pin_video_block"===O[e].type):null,R=A?O[A].media:D;if(!R||"localVideo"!==R.type)throw new Error("Unable to upload video - media is invalid.");n(Object(f.A)(e,null)),"succeeded"===v&&n(Object(f.L)(e,"uploading")),n(Object(m.setPinBuilderPinDraftUploadStatus)(e,"uploading")),n(Object(m.addPinBuilderPinDraftItemUpload)(e,t,{status:"uploading",xhr:null}));let N=e=>n(Object(u.r)(t,{uploadProgress:Math.round(e.loaded/e.total*100)}));T&&A&&(N=t=>n(Object(l.f)(e,A,{uploadProgress:Math.round(t.loaded/t.total*100)})));const M=(p=0)=>{Object(b.l)(R.fileSrc,S?"video-story-pin":"video",T||!o.a.enabled("videoEditing"),{onCancelUpload:e=>function(e,t,n){Object(s.a)(7684,{file_size_mb:t.fileSrc.size/Math.pow(1024,2),media_upload_id:e,story_pin_page_id:n,video_duration:t.duration})}(e,R,w),onFailureUpload:({message:e,failureReason:t,uploadId:n})=>function(e,t,n,i,r){Object(s.a)(8786,{error_message:t,file_size_mb:i.fileSrc.size/Math.pow(1024,2),media_upload_failure_reason:n||"general",media_upload_id:e,story_pin_page_id:r,video_duration:i.duration}),a.a.increment("video_pin_creation.uploading.failure",1,{failure_reason:t})}(n,e,t,R,w),onFinishProcessing:({processingTime:e,signature:t,uploadId:n})=>function(e,t,n,i,r){Object(s.a)(7520,{file_size_mb:i.fileSrc.size/Math.pow(1024,2),media_upload_id:e,processing_time:t,story_pin_page_id:r,video_duration:i.duration,video_signature:n}),Object(s.a)(7521,{file_size_mb:i.fileSrc.size/Math.pow(1024,2),media_upload_id:e,story_pin_page_id:r,video_duration:i.duration,video_signature:n})}(n,e,t,R,w),onFinishUpload:({amzId2:e,amzRequestId:t,statusCode:n,uploadId:i,uploadTime:r})=>function({amzId2:e,amzRequestId:t,statusCode:n,storyPageNumber:i,uploadId:r,uploadTime:o,video:d}){Object(s.a)(7519,{aws_tracking_ids:JSON.stringify([t,e]),file_size_mb:d.fileSrc.size/Math.pow(1024,2),media_upload_id:r,status_code:n,story_pin_page_id:i,upload_time:o,video_duration:d.duration}),a.a.increment("video_pin_creation.uploading.success",1,{app_type:"web"})}({amzId2:e,amzRequestId:t,statusCode:n,storyPageNumber:w,uploadId:i,uploadTime:r,video:R}),onProgress:e=>S?N(e):n(Object(c.q)(t,{uploadProgress:Math.round(e.loaded/e.total*100)})),onStartProcessing:({signature:e,uploadId:t})=>function(e,t,n,i){Object(s.a)(8809,{file_size_mb:n.fileSrc.size/Math.pow(1024,2),media_upload_id:e,story_pin_page_id:i,video_duration:n.duration,video_signature:t})}(t,e,R,w),onStartUpload:({uploadId:i})=>n(function(e,t,n,i,r,a){return(d,p)=>{const m=p(),{pinbuilder:f}=m,{storyPinItemBlocks:b,storyPinItems:h}=f;if(r)if(o.a.enabled("storyPinExpressive")&&h[t]&&h[t].blockIds.length){const i=h[t].blockIds.find(e=>"story_pin_video_block"===b[e].type);i&&d(Object(l.f)(e,i,{uploadId:n}))}else d(Object(u.r)(t,{uploadId:n}));else d(Object(c.q)(t,{uploadId:n}));Object(s.a)(7518,{file_size_mb:i.fileSrc.size/Math.pow(1024,2),media_upload_id:n,story_pin_page_id:a,video_duration:i.duration})}}(e,t,i,R,S,w)),setXhr:i=>n(Object(m.setPinBuilderPinItemUploadXhr)(e,t,i))}).then(r=>{const a=i(),{pinbuilder:s}=a,{pinDraftIdUploadStatusMap:d}=s;if(n(Object(m.setPinBuilderPinItemUploadXhr)(e,t,null)),S)if(T&&A){if(n(Object(l.f)(e,A,{signature:r.signature})),d[e]&&d[e].items[t]&&"queueEdit"===d[e].items[t].status)return void("queueCreate"===d[e].status&&n(h(e,t)))}else n(Object(u.r)(t,{signature:r.signature}));else n(Object(c.q)(t,{signature:r.signature}));n(Object(m.setPinBuilderPinItemUploadStatus)(e,t,"completed"));const p=Object.keys(d[e].items).filter(t=>d[e].items[t].status.startsWith("uploading")||d[e].items[t].status.startsWith("queue"));"queueCreate"===d[e].status&&(0===p.length||1===p.length&&p[0]===t)&&(n(Object(f.f)({pinDraftId:e})),n(Object(m.setPinBuilderPinDraftUploadStatus)(e,"completed")));(0===p.length||1===p.length&&!!d[e].items[t])&&(o.a.enabled("multi_pin")||o.a.enabled("multi_pin_pinner")||o.a.enabled("offsite_pin_creation_multi_select")||S||"queueCreate"!==d[e].status)&&n(Object(m.removePinBuilderPinDraftUpload)(e))}).catch(a=>{const o=i(),{pinbuilder:s}=o,{pinDraftIdUploadStatusMap:c}=s;if(!a||a.isError)if(T&&p<d.H)M(p+1);else{const i=g.length>1?r.a._("Upload failed","pinbuilder.upload.video.upload.error","Error message uploading a video file"):r.a._("Upload failed. Try again?","pinbuilder.upload.video.upload.error","Error message uploading a video file + asks User if they would like to try again");n(Object(f.A)(e,i)),n(Object(f.L)(e,"attempted")),n(Object(m.removePinBuilderPinItemUpload)(e,t)),1===Object.keys(c[e].items).length&&n(Object(m.removePinBuilderPinDraftUpload)(e))}})};M()}}function I(e){return(t,n)=>{const a=n(),{pinbuilder:o}=a,{pinDrafts:s,pinItems:d,pinDraftIds:l}=o,{pinItemIds:u,pinItemIndex:p,type:h}=s[e];if("single"===h){const a=u[p],{media:o,canvasJson:s}=d[a],h=o&&o.signature?o.signature:null;if(o&&h){const d=s?Object(i.a)(o,s):null;d&&Object(b.f)(h,"video",d,{onStartEdits:e=>t(Object(c.q)(a,{uploadId:e}))}).then(()=>{const i=n(),{pinbuilder:r}=i,{pinDraftIdUploadStatusMap:a}=r;"queueCreate"===a[e].status&&t(Object(f.f)({pinDraftId:e})),t(Object(m.removePinBuilderPinDraftUpload)(e))}).catch(()=>{const n=l.length>1?r.a._("Upload failed","pinbuilder.upload.video.edit.error","Error message uploading an edit for the video"):r.a._("Upload failed. Try again?","pinbuilder.upload.video.edit.error","Error message uploading an edit for the video + asks if they would like to try again");t(Object(f.A)(e,n)),t(Object(f.L)(e,"attempted")),t(Object(m.removePinBuilderPinDraftUpload)(e))})}}}}},"0ll5":function(e,t,n){n.d(t,"a",(function(){return r}));var i=n("IIK6");function r(e){return i.c[e]}},"0wxR":function(e,t,n){n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var i=n("eOdZ"),r=n("NjDU");function a(e){return{type:"SCHEDULED_PIN_CREATE_COMPLETE",payload:{scheduledPin:e}}}function o(e){return(t,n)=>{const{viewer:a}=n(),o=a.isAuth?a.id:"";return t(function(e){return{type:"SCHEDULED_PIN_DELETE_COMPLETE",payload:{scheduledPinId:e}}}(e)),t(Object(r.d)({userId:o,increment:-1})),i.a.create("ScheduledPinResource",{scheduled_pin_id:e}).callDelete()}}function s(e){return(t,n)=>{const{viewer:a}=n(),o=a.isAuth?a.id:"";return t(function(e){return{type:"SCHEDULED_PIN_PUBLISH_COMPLETE",payload:{scheduledPinId:e}}}(e)),t(Object(r.d)({userId:o,increment:-1})),i.a.create("ScheduledPinResource",{method:"publish",scheduled_pin_id:e}).callCreate()}}},"1Naj":function(e,t,n){function i(e,t,n){return{type:"PIN_TAG_ADD_TAGGED_OBJECT",payload:{pinTagId:e,taggedObjectId:t,taggedObject:n}}}n.d(t,"a",(function(){return i}))},"26Ai":function(e,t,n){function i(){return Promise.all([n.e(482),n.e(483),n.e(398)]).then(n.bind(null,"KiYd")).then(({default:e})=>e)}n.d(t,"a",(function(){return i}))},"3bT9":function(e,t,n){n.d(t,"a",(function(){return a}));var i=n("26Ai"),r=n("lPMS");function a(e,t,n){return Object(i.a)().then(i=>{const a=e[0],{media:o}=t[a]||{},{width:s}=o||{},d=e.every(e=>{const{media:n}=t[e]||{};if(!n)return!0;const{width:i}=n||{};return i===s})?s:r.o,c=e.map(e=>{const r=new i(document.createElement("div")),{canvasJson:a,media:o}=t[e]||{};if(!o)return t[e];const s=()=>(r.setAspectRatio(n),{...t[e],canvasJson:r.toJSON(),media:{...o,...r.getCanvasOutput({width:d})}});return a?r.loadFromJSON(a).then(s):r.setImage(o.src).then(s)});return Promise.all(c)})}},"49PI":function(e,t,n){n.r(t),n.d(t,"topTaggedObjectsResourceOptions",(function(){return G})),n.d(t,"default",(function(){return H}));var i=n("q1tI"),r=n("n6mq"),a=n("nKUr");function o({accessibilityLabel:e,arrowOnly:t=!1,direction:n,onClick:i,show:o}){const s="back"===n;return Object(a.jsx)(r.f,{position:"absolute",left:s,right:!s,top:!0,bottom:!0,dangerouslySetInlineStyle:{__style:{backgroundImage:`linear-gradient(to ${s?"left":"right"}, transparent 0%, #fff 90%)`}},children:Object(a.jsx)(r.f,{height:"100%",width:44,display:"flex",justifyContent:"center",alignItems:"center",children:o&&Object(a.jsx)(r.w,{accessibilityLabel:e,bgColor:t?"transparent":"white",icon:s?"arrow-back":"arrow-forward",iconColor:"darkGray",onClick:i})})})}var s=n("N84b");function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class c extends i.Component{constructor(...e){super(...e),d(this,"state",{isHovering:!1,showBack:!1,showForward:!1}),d(this,"saveScrollBarRef",e=>{this.scrollbar=e}),d(this,"refreshArrows",()=>{const{showBack:e,showForward:t}=this.state;if(this.scrollbar){const{offsetWidth:n,scrollLeft:i,scrollWidth:r}=this.scrollbar,a=i>0,o=i+n<r;a===e&&o===t||this.setState({showBack:a,showForward:o})}}),d(this,"scroll",e=>{this.scrollbar&&0!==e&&(this.scrollAnimationManager&&this.scrollAnimationManager.cancel(),this.scrollAnimationManager=Object(s.b)(this.scrollbar,e,0,{onAnimationComplete:()=>{this.refreshArrows(),this.scrollAnimationManager=null}}),this.scrollAnimationManager.start())}),d(this,"handleMouseEnter",()=>this.setState({isHovering:!0})),d(this,"handleMouseLeave",()=>this.setState({isHovering:!1})),d(this,"handleResizeOrScroll",()=>this.refreshArrows()),d(this,"handleBackArrowClick",()=>{const{columnWidth:e,gutterWidth:t}=this.props;if(this.scrollbar){const{scrollLeft:n}=this.scrollbar,i=n>e+t?e+t:n;this.scroll(-i)}}),d(this,"handleForwardArrowClick",()=>{const{columnWidth:e,gutterWidth:t}=this.props;if(this.scrollbar){const{offsetWidth:n,scrollLeft:i,scrollWidth:r}=this.scrollbar,a=r-i-n,o=a>e+t?e+t:a;this.scroll(o)}})}componentDidMount(){this.props.hideArrows||(window.addEventListener("resize",this.handleResizeOrScroll),this.refreshArrows())}componentWillUnmount(){this.props.hideArrows||window.removeEventListener("resize",this.handleResizeOrScroll)}render(){const{accessibilityBackLabel:e,accessibilityForwardLabel:t,arrowOnly:n=!1,columnWidth:i,gutterWidth:s,hideArrows:d=!1,items:c,paddingY:l,hideScrollbar:u,showArrowButton:p}=this.props,{isHovering:m,showBack:f,showForward:b}=this.state;return Object(a.jsxs)("div",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,style:{position:"relative"},children:[Object(a.jsx)("div",{ref:this.saveScrollBarRef,onScroll:this.handleResizeOrScroll,style:{overflowX:u?"hidden":"auto"},children:Object(a.jsx)(r.f,{display:"flex",position:"relative",paddingY:l,children:c.map((e,t)=>{const n={__style:{marginRight:t===c.length-1?0:s}};return Object(a.jsx)(r.f,{width:i,dangerouslySetInlineStyle:n,children:e},t)})})}),f&&!d&&Object(a.jsx)(o,{accessibilityLabel:e,arrowOnly:n,direction:"back",onClick:this.handleBackArrowClick,show:m||p||!1}),b&&!d&&Object(a.jsx)(o,{accessibilityLabel:t,arrowOnly:n,direction:"forward",onClick:this.handleForwardArrowClick,show:m||p||!1})]})}}var l=c,u=n("T+9/"),p=n("Ye/N"),m=n("qD10"),f=n("I7CA"),b=n("vcEN"),h=n("7wXf"),_=n("mwIZ"),I=n.n(_),g=n("HaiL");const[y,O,P,E]=[1,2,3,4],v={[y]:"In stock",[O]:"Out of stock",[P]:"Preorder",[E]:"Unavailable"};function j(e){const{buyableProduct:t,hideAvailability:n,merchantName:i,pinDescription:o,pinTitle:s,richSummary:d,showProductIcon:c,showPrice:l,showDescription:u}=e,{is_available:p,display_active_min_price:m,display_active_max_price:f}=t||{},b=m===f?m:`${null!=m?m:""} - ${null!=f?f:""}`,h=I()(d,["products","0","offer_summary","price"]),_=b||h,P=p?y:O,E=I()(d,["products","0","offer_summary","availability"]),j=t&&null!=p?P:E,S=!n&&v[j];return Object(a.jsxs)(r.f,{marginTop:1,children:[c&&Object(a.jsx)(r.f,{paddingY:1,display:"flex",children:Object(a.jsx)(g.a,{text:i,icon:"tag"})}),!!_&&l&&Object(a.jsxs)(r.f,{display:"flex",paddingY:1,children:[Object(a.jsx)(r.f,{marginEnd:2,children:Object(a.jsx)(r.cb,{size:"md",children:_})}),S&&j===O&&Object(a.jsx)(r.cb,{size:"md",color:"gray",children:S})]}),u&&Object(a.jsx)(r.f,{paddingY:1,children:Object(a.jsx)(r.cb,{size:"md",weight:"bold",children:s||o})})]})}var S=n("/MKj"),D=n("zwad"),T=n("gqRH");function w({domain:e,maxWidth:t,onClick:n,pinId:o,sourceLinkStyle:s,sourceUrl:d}){const[c,l]=Object(i.useState)(!1),u=Object(i.useCallback)(()=>l(!0),[l]),m=Object(i.useCallback)(()=>l(!1),[l]),f=Object(S.useSelector)(({pins:e})=>o&&e?e[o]:void 0),b=D.a.isOffsiteUrl(d),h=Object(T.b)({href:d,target:b?"blank":null,externalData:{pin:f}}),_=2*t/3;return _<72&&(s="icon-only"),"icon-only"===s?Object(a.jsx)(r.w,{accessibilityLabel:p.a._("link","Website url link","Website url link"),bgColor:"white",href:d,icon:"arrow-up-right",iconColor:"darkGray",onClick:({event:e,disableOnNavigation:t})=>{t(),n(),h({event:e})},size:_>58?"sm":"xs",role:"link",rel:b?"nofollow":"none"}):Object(a.jsx)(r.bb,{href:d,fullWidth:!1,onMouseEnter:u,onMouseLeave:m,onTap:({event:e,disableOnNavigation:t})=>{t(),n(),h({event:e})},rel:b?"nofollow":"none",role:"link",children:Object(a.jsxs)(r.f,{alignItems:"baseline",dangerouslySetInlineStyle:{__style:{backgroundColor:c?"rgba(255, 255, 255, 1.0)":"rgba(255, 255, 255, 0.9)",borderRadius:"18px"}},display:"flex",height:32,justifyContent:"between",maxWidth:_,position:"relative",children:[Object(a.jsx)(r.f,{display:"flex",flex:"none",marginTop:3,marginBottom:3,marginStart:3,children:Object(a.jsx)(r.v,{accessibilityLabel:p.a._("link","Website url link","Website url link"),color:"darkGray",icon:"arrow-up-right",size:9})}),Object(a.jsx)(r.f,{alignItems:"center",display:"flex",height:18,marginStart:2,marginEnd:3,overflow:"hidden",children:Object(a.jsx)(r.cb,{color:"darkGray",size:"md",weight:"bold",truncate:!0,children:e})})]})})}var A=n("Zxas"),R=n("TNox");const N=80,M="â€¦";var k=n("0nTG"),U=n("U4JR"),C=n("mVz+");const x={visualOverlay:{backgroundColor:"#000",opacity:C.f}};function L(e){var t;const[n,o]=Object(i.useState)(!1),s=Object(i.useCallback)(()=>o(!0),[o]),d=Object(i.useCallback)(()=>o(!1),[o]),{link:c,pin:l,onClick:u}=e,p=C.h,m=C.g,{description:_,domain:I,title:g,id:y,link:O,rich_summary:P,images:{"474x":E}={}}=l,{height:v,width:S,url:D}=null!=E?E:{},T=g||P&&P.display_name,L=Object(k.c)(l),B=L&&function(e,t={}){const{maxLength:n=N,suffix:i=M}=t;return e.length<=n?e:e.substring(0,n-1).replace(/[\- _,.<>:;+=*&@~\/\|!]*$/,"")+i}(L,{maxLength:p/C.e});return Object(a.jsxs)(r.f,{width:p,position:"relative",onMouseEnter:s,onMouseLeave:d,children:[Object(a.jsxs)(r.f,{position:"relative",children:[Object(a.jsx)(R.a,{rounding:2,href:c,onTap:({event:e})=>{e.stopPropagation(),null==u||u(e)},children:Object(a.jsxs)(r.C,{rounding:2,height:m,width:p,wash:!0,children:[Object(a.jsx)(r.x,{alt:null!==(t=null!=T?T:_)&&void 0!==t?t:"",naturalHeight:null!=v?v:1,naturalWidth:null!=S?S:1,src:null!=D?D:"",fit:"cover"}),n&&Object(a.jsx)(b.a,{visibility:"visible",children:Object(a.jsx)(f.a,{additionalStyles:x.visualOverlay})})]})}),Object(a.jsx)(r.f,{position:"absolute",margin:2,left:!0,right:!0,top:!0,children:Object(a.jsx)(h.a,{pin:l,allowShoppingPriceIndicator:!0})}),n&&Object(a.jsx)(r.f,{display:"flex",position:"absolute",margin:3,left:!0,right:!0,bottom:!0,children:O&&Object(a.jsx)(w,{pinId:y,sourceUrl:O,domain:null!=I?I:"",sourceLinkStyle:"icon-only",maxWidth:p,onClick:()=>{const{componentType:t,viewData:n,viewType:i,viewParameter:r}=e;Object(U.b)(12,{component:t,objectId:y,view:i,viewParameter:r,viewData:n})}})})]}),Object(a.jsx)(R.a,{href:c,onTap:({event:e})=>{e.stopPropagation(),null==u||u(e)},children:Object(a.jsx)(j,{pinDescription:_&&Object(A.a)(_.trim(),C.c)||"",pinTitle:T&&Object(A.a)(T.trim(),C.c)||"",richSummary:P,merchantName:B})})]})}var B=n("w70y"),F=n("vvax"),V=n("Y8Sn"),z=n("7jH2");const G=(e,t)=>({pinId:e,isSTL:t});function H(e){const{pin:t,trafficSource:n}=e,{data:i,isLoaded:o}=Object(B.a)({name:"VisualLinkTopTaggedObjectsResource",options:G(t.id,!(!t.aggregated_pin_data||!t.aggregated_pin_data.is_shop_the_look))}),{aggregated_pin_data:s={}}=t;if(!o)return Object(a.jsx)(r.f,{paddingY:6,children:Object(a.jsx)(r.U,{accessibilityLabel:p.a._("Loading Shop the Look","Loading message for Shop the Look on Closeup","Loading message for Shop the Look on Closeup"),show:!0})});const d=()=>{Object(U.b)(101,{view:3,component:85,element:10479,commerce_data:JSON.stringify({pin_is_shop_the_look:null==s?void 0:s.is_shop_the_look,pin_is_stela:null==s?void 0:s.is_stela})}),Object(U.b)(8948,{closeup_navigation_type:n&&Object(V.k)(n)?"deeplink":"click",view:3,component:85,element:10479,commerce_data:JSON.stringify({pin_is_shop_the_look:null==s?void 0:s.is_shop_the_look,pin_is_stela:null==s?void 0:s.is_stela})})};if(!i||0===i.length)return null;const c=i.map(n=>{const{id:i,objects:o,title:s}=n,c=o.filter(e=>"pin"===e.type),f=t&&t.closeup_attribution?t.closeup_attribution:s&&o.find(e=>"user"===e.type&&e.id===s.args[0].id),b=f&&f.username||"",h=f?f.full_name:s&&s.args[0].text,_=c.map((n,i)=>{var r,o,s;return Object(a.jsx)(u.a,{impressionType:"Pin",impressionAuxFields:{richTypes:Object(k.e)(n),imageURL:null!==(r=null===(o=n.images)||void 0===o||null===(s=o["236x"])||void 0===s?void 0:s.url)&&void 0!==r?r:""},loggingId:n.id,slotIndex:i,viewData:{pin_id:t.id},viewType:3,viewParameter:Object(z.d)(Object(z.r)(e)),componentType:13160,children:Object(a.jsx)(L,{link:`/pin/${n.id}/`,onClick:d,pin:n,viewData:{pin_id:t.id},viewType:3,viewParameter:Object(z.d)(Object(z.r)(e)),componentType:13160})},"carousel-impression-key-"+i)});return Object(a.jsxs)(r.f,{"data-test-id":"shop-the-look-unit",children:[Object(a.jsxs)(r.f,{"data-test-id":"shop-the-look",marginBottom:4,marginTop:10,children:[Object(a.jsx)(r.u,{size:"sm",children:p.a._("Shop the look","Shop the Look from user text on closeup","Shop the Look from user text on closeup")}),s&&s.args[0]&&Object(a.jsx)(r.cb,{children:Object(F.b)(p.a._("from {{ pinnerName }}","Shows who owns the products tagged in this Pin, on closeup","Shows who owns the products tagged in this Pin, on closeup"),{pinnerName:Object(a.jsx)(m.a,{to:`/${b}/`,children:Object(a.jsx)(r.cb,{inline:!0,weight:"bold",children:h})},"pinner")})})]}),Object(a.jsx)(l,{accessibilityBackLabel:p.a._("Previous product","Label for previous product in shop the look","Label for previous product in shop the look"),accessibilityForwardLabel:p.a._("Next product","Label for next product in shop the look","Label for next product in shop the look"),columnWidth:C.h,gutterWidth:C.d,hideArrows:!0,items:_})]},i)});return Object(a.jsx)(r.f,{children:c})}},"4AHh":function(e,t,n){n.d(t,"a",(function(){return l}));var i=n("qfnd"),r=n("8nxc"),a=n("WPUZ"),o=n("wtY2"),s=n("7Cbv"),d=n("PM+C"),c=n("D2+t");function l(e,t,n,l){return u=>{const p=r.a.enabled("storyPinExpressive");if(u(Object(i.a)(e,t,p?{...n,backgroundColor:o.m,media:null}:n,l)),p&&null!=n&&n.media){const{media:i}=n;"localImage"===i.type?u(Object(a.a)(e,t,Object(s.a)(),{media:i,edits:Object(d.e)(i),type:"story_pin_image_block"},0)):"localVideo"===i.type&&u(Object(a.a)(e,t,Object(s.a)(),{media:i,edits:Object(d.e)(i),type:"story_pin_video_block"},0));("localImage"===i.type?Object(d.f)(i):Promise.resolve([])).then(n=>{u(Object(c.h)(t,n)),n.length>0&&u(Object(c.b)(e,t,n[0]))})}}}},"8h0Y":function(e,t,n){n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return p})),n.d(t,"j",(function(){return m})),n.d(t,"g",(function(){return f})),n.d(t,"i",(function(){return b})),n.d(t,"f",(function(){return h})),n.d(t,"d",(function(){return _})),n.d(t,"k",(function(){return I}));var i=n("PioT"),r=n("7w6Q"),a=n("U4JR"),o=n("nEAA"),s=n("HMdf");function d(){var e,t,n,r,a,o,d,c;return{browser:i.b.getBrowser(),speedBucket:Object(s.g)(Object(s.b)(window.performance.getEntriesByType("resource"),!1)),resourceSpeedBucket:Object(s.g)(Object(s.b)(window.performance.getEntriesByType("resource").filter(e=>e.name.includes("/resource/")),!1)),cdnSpeedBucket:Object(s.g)(Object(s.b)(window.performance.getEntriesByType("resource").filter(e=>e.name.includes(".pinimg.")),!1)),effectiveType:(null===(e=window.navigator)||void 0===e||null===(t=e.connection)||void 0===t?void 0:t.effectiveType)||"unknown",rtt:(null===(n=window.navigator)||void 0===n||null===(r=n.connection)||void 0===r?void 0:r.rtt)||-1,downlink:(null===(a=window.navigator)||void 0===a||null===(o=a.connection)||void 0===o?void 0:o.downlink)||-1,deviceMemory:(null===(d=window.navigator)||void 0===d?void 0:d.deviceMemory)||-1,hardwareConcurrency:(null===(c=window.navigator)||void 0===c?void 0:c.hardwareConcurrency)||-1}}function c(){const{browser:e,effectiveType:t}=d();return 1===e&&("2g"===t||"slow-2g"===t)}function l({fileSizeBytes:e,pinDraftId:t,storyPageNumber:n,uploadId:i,storyPinPublishStopwatch:r}){const s=e/1024;null==r||r.subspanStart({name:"image_page_upload",parentId:i,id:i+"-upload"}),null==r||r.binaryAnnotationOperation("totalImageUploadSizeKB",Object(o.b)(s),(e,t)=>Number(e)+Number(t)),null==r||r.binaryAnnotationOperation("total.size.raw.kilobytes",Object(o.b)(s),(e,t)=>Number(e)+Number(t)),null==r||r.binaryAnnotationOperation("total.size.exported.kilobytes",Object(o.b)(s),(e,t)=>Number(e)+Number(t)),Object(a.b)(8780,{file_size_mb:e/Math.pow(1024,2),media_upload_id:i,story_pin_page_id:n,story_pin_upload_id:t,...d()})}function u({fileSizeBytes:e,imageSig:t,pinDraftId:n,storyPageNumber:i,uploadId:r,uploadTimeSec:s,storyPinPublishStopwatch:c}){null==c||c.subspanStop({name:"image_page_upload",id:r+"-upload"}),null==c||c.subspanStop({name:"image_page_publish",binaryAnnotations:{"pwt.result":Object(o.c)(1),"image.signature":Object(o.d)(r),"image.size.raw.kilobytes":Object(o.b)(e),"image.size.exported.kilobytes":Object(o.b)(e)},id:r,parentId:c.getTraceId()}),Object(a.b)(8781,{file_size_mb:e/Math.pow(1024,2),image_signature:t,media_upload_id:r,story_pin_page_id:i,story_pin_upload_id:n,upload_time:s,...d()})}function p({errorMsg:e,pinDraftId:t,mediaUploadFailureReason:n,mediaStatusFailureReason:i,uploadId:r,fileSizeBytes:s,storyPageNumber:c,storyPinPublishStopwatch:l}){null==l||l.subspanStop({name:"image_page_upload",id:(r||"")+"-upload"}),null==l||l.subspanStop({name:"image_page_publish",binaryAnnotations:{"pwt.result":Object(o.c)(3),"image.signature":Object(o.d)(r),"image.size.raw.kilobytes":Object(o.b)(s),"image.size.exported.kilobytes":Object(o.b)(s)},id:r}),Object(a.b)(8785,{file_size_mb:s/Math.pow(1024,2),media_upload_id:r,story_pin_page_id:c,story_pin_upload_id:t,error_message:e,media_upload_failure_reason:n,media_status_failure_reason:i,...d()})}function m({fileSizeBytes:e,storyPageNumber:t,uploadId:n,videoDuration:i,storyPinPublishStopwatch:r}){const s=e/1024;null==r||r.subspanStart({name:"video_page_upload",parentId:n,id:n+"-upload"}),null==r||r.binaryAnnotationOperation("totalVideoUploadSizeKB",Object(o.b)(s),(e,t)=>Number(e)+Number(t)),null==r||r.binaryAnnotationOperation("total.size.raw.kilobytes",Object(o.b)(s),(e,t)=>Number(e)+Number(t)),null==r||r.binaryAnnotationOperation("total.size.exported.kilobytes",Object(o.b)(s),(e,t)=>Number(e)+Number(t)),null==r||r.binaryAnnotationOperation("total.video.duration",Object(o.b)(i),(e,t)=>Number(e)+Number(t)),Object(a.b)(7518,{file_size_mb:e/Math.pow(1024,2),media_upload_id:n,story_pin_page_id:t,video_duration:i,...d()})}function f({amzId2:e,amzRequestId:t,fileSizeBytes:n,statusCode:i,storyPageNumber:s,uploadId:c,uploadTimeSec:l,videoDuration:u,storyPinPublishStopwatch:p}){null==p||p.subspanStop({name:"video_page_upload",id:c+"-upload"}),null==p||p.subspanStop({name:"video_page_publish",binaryAnnotations:{"pwt.result":Object(o.c)(1),"video.signature":Object(o.d)(c),"video.size.raw.kilobytes":Object(o.b)(n),"video.size.exported.kilobytes":Object(o.b)(n),"video.duration":Object(o.b)(u)},id:c}),Object(a.b)(7519,{aws_tracking_ids:JSON.stringify([t,e]),file_size_mb:n/Math.pow(1024,2),media_upload_id:c,status_code:i,story_pin_page_id:s,upload_time:l,video_duration:u,...d()}),r.a.increment("video_pin_creation.uploading.success",1,{app_type:"web"})}function b({fileSizeBytes:e,signature:t,storyPageNumber:n,uploadId:i,videoDuration:r,storyPinPublishStopwatch:o}){null==o||o.subspanStart({name:"video_processing",parentId:i,id:i+"-processing"}),Object(a.b)(8809,{file_size_mb:e/Math.pow(1024,2),media_upload_id:i,story_pin_page_id:n,video_duration:r,video_signature:t,...d()})}function h({fileSizeBytes:e,processingTimeSec:t,signature:n,storyPageNumber:i,uploadId:r,videoDuration:o,storyPinPublishStopwatch:s}){null==s||s.subspanStop({name:"video_processing",id:r+"-processing"}),Object(a.b)(7520,{file_size_mb:e/Math.pow(1024,2),media_upload_id:r,processing_time:t,story_pin_page_id:i,video_duration:o,video_signature:n,...d()}),Object(a.b)(7521,{file_size_mb:e/Math.pow(1024,2),media_upload_id:r,story_pin_page_id:i,video_duration:o,video_signature:n,...d()})}function _({errorMessage:e,fileSizeBytes:t,mediaUploadFailureReason:n,storyPageNumber:i,uploadId:s,videoDuration:c,storyPinPublishStopwatch:l}){null==l||l.subspanStop({name:"video_page_upload",id:s+"-upload"}),null==l||l.subspanStop({name:"video_page_publish",binaryAnnotations:{"pwt.result":Object(o.c)(3),"video.signature":Object(o.d)(s),"video.size.raw.kilobytes":Object(o.b)(t),"video.size.exported.kilobytes":Object(o.b)(t),"video.duration":Object(o.b)(c),reason:Object(o.d)(n),error_message:Object(o.d)(e)},id:s}),Object(a.b)(8786,{error_message:e,file_size_mb:t/Math.pow(1024,2),media_upload_failure_reason:n,media_upload_id:s,story_pin_page_id:i,video_duration:c,...d()}),r.a.increment("video_pin_creation.uploading.failure",1,{failure_reason:n})}function I(e){return e.preventDefault(),e.returnValue=" "," "}},"8mez":function(e,t,n){function i(e,t,n){return{type:"PIN_BUILDER_ADD_PIN_DRAFT",payload:{pinDraftId:e,pinDraft:t,options:n}}}n.d(t,"a",(function(){return i}))},"9KEC":function(e,t,n){n.d(t,"g",(function(){return h})),n.d(t,"o",(function(){return _})),n.d(t,"l",(function(){return I})),n.d(t,"q",(function(){return g})),n.d(t,"j",(function(){return y})),n.d(t,"k",(function(){return O})),n.d(t,"n",(function(){return P})),n.d(t,"m",(function(){return v})),n.d(t,"h",(function(){return j})),n.d(t,"p",(function(){return S})),n.d(t,"d",(function(){return T})),n.d(t,"e",(function(){return A})),n.d(t,"f",(function(){return R})),n.d(t,"i",(function(){return N})),n.d(t,"a",(function(){return M})),n.d(t,"c",(function(){return k})),n.d(t,"b",(function(){return U}));var i=n("NZVI"),r=n("DtZN"),a=n("f+bf"),o=n("eOdZ"),s=n("zwad"),d=n("dYnk"),c=n("kAa9"),l=n("Wer7"),u=n("r0wO"),p=n("49PI"),m=n("U4JR"),f=n("7Cbv"),b=n("ZQVr");function h(e,t,n){return{type:"PIN_ITEM_SET_DESCRIPTION_ERROR",payload:{pinItemId:e,descriptionError:t,signals:n}}}function _(e,t,n){return{type:"PIN_ITEM_SET_TITLE_ERROR",payload:{pinItemId:e,titleError:t,signals:n}}}function I(e,t){return{type:"PIN_ITEM_SET_MEDIA",payload:{pinItemId:e,media:t}}}function g(e,t){return{type:"PIN_ITEM_UPDATE_MEDIA",payload:{pinItemId:e,media:t}}}function y(e,t){return{type:"PIN_ITEM_SET_LINK",payload:{pinItemId:e,link:t}}}function O(e,t,n){return{type:"PIN_ITEM_SET_LINK_ERROR",payload:{pinItemId:e,linkError:t,signals:n}}}function P(e,t){return{type:"PIN_ITEM_SET_TAG_ERROR",payload:{pinItemId:e,tagError:t}}}function E(e,t){return(n,i)=>{const{pinbuilder:{pinTags:r}}=i(),{status:a}=r[t];n("created"===a?function(e,t){return{type:"PIN_ITEM_REMOVE_PIN_TAG",payload:{pinItemId:e,pinTagId:t}}}(e,t):Object(u.e)(t,"deleted"))}}function v(e,t){return{type:"PIN_ITEM_SET_SELECTED_PIN_TAG_ID",payload:{pinItemId:e,selectedPinTagId:t}}}function j(e,t,n){return{type:"PIN_ITEM_SET_EDITED_IMAGE",payload:{pinItemId:e,editedMedia:t,canvasJson:n}}}function S(e,t){return{type:"PIN_ITEM_UPDATE_DATA",payload:{pinItemId:e,pinItem:t}}}const D=e=>{Object(m.b)(9070,{view:212,component:13308,element:10973,api_error_code:e.api_error_code,api_error_message:e.message})};function T(e){const t=Object(c.b)();return(n,i)=>{const r=i(),{selectedPinTagId:a}=r.pinbuilder.pinItems[e];n(v(e,null)),a&&0===t(r,{pinTagId:a}).length&&n(E(e,a))}}function w(e,t){return e.map(e=>{const{id:n,link:i,media:r,type:a}=e;return!!s.a.isTrustedOrigin(i)&&/\/pin\/[\w-]+\/?$/.test(i)||"pin"===a?{id:n}:Object(b.c)({link:i,board_id:t,image_url:r?r.url:"",method:"scraped",scrape_metric:{source:"www_url_scrape"}})})}function A(e,t){return(n,i)=>{const s=i(),{pinItems:d,pinTags:c}=s.pinbuilder,{pinTagIds:u}=d[e],m=u.map(e=>{const{status:n}=c[e];return"deleted"===n?function(e,t,n){return o.a.create("VisualLinkPinTagResource",{pinTagId:e,id:t}).callDelete()}(e,t):"created"===n?function(e,t,n){const{pinbuilder:i,viewer:r}=n,{pinTags:a,taggedObjects:s}=i,{taggedObjectIds:d,x:c,y:l}=a[e];return Object(b.e)().then(e=>{const n=w(d.map(e=>s[e]),e.id);return Promise.all(n).then(e=>o.a.create("VisualLinkPinTagsAndObjectsResource",{pinId:t,pinTagsAndObjects:[{country:r.isAuth?r.country:void 0,height:0,tagged_objects:e.map(e=>e.id),width:0,x_coord:100*c,y_coord:100*l}]}).callUpdate().catch(e=>{D(e)}))})}(e,t,s):"edited"===n?function(e,t,n){const{pinTags:i,taggedObjects:r}=n.pinbuilder,{pinTagKey:a,taggedObjectIds:s,x:d,y:c}=i[e];return Object(b.e)().then(n=>{const i=w(s.filter(e=>"created"===r[e].status).map(e=>r[e]),n.id);return Promise.all(i).then(n=>{const i=o.a.create("VisualLinkTaggedObjectsBatchResource",{pinTagKey:a,taggedObjectIds:n.map(e=>e.id),taggedObjectSource:"pinterest-client"}).callUpdate(),l=o.a.create("VisualLinkTaggedObjectsResource",{pinTagId:e,taggedObjectIds:s.filter(e=>"deleted"===r[e].status)}).callDelete();return Promise.all([i,l]).then(()=>o.a.create("VisualLinkPinTagResource",{pinTagId:e,id:t,pinTag:{dimensions:{x:100*d,y:100*c}}}).callCreate())})})}(e,t,s):null});Promise.all(m).then(()=>{n(Object(l.f)("PinResource",Object(r.a)(t))),n(Object(l.f)("VisualLinkTopTaggedObjectsResource",Object(p.topTaggedObjectsResourceOptions)(t,!0))),n(Object(a.a)(t))})}}function R(e,t,n){return(i,r)=>{const{pinbuilder:a,viewer:s}=r(),{pinItems:d,pinTags:c,taggedObjects:l}=a;if(!d[e])return Promise.resolve();const{pinTagIds:u}=d[e],p=u.reduce((e,t)=>{const{taggedObjectIds:n}=c[t];return n.forEach(t=>e.push(l[t])),e},[]);return p.length>0?Object(b.e)().then(e=>{const i=w(p,e.id);return Promise.all(i).then(e=>{const i=e.map(e=>e.id),r=u.map(e=>{const{taggedObjectIds:t,x:n,y:r}=c[e],a=i.splice(0,t.length);return{country:s.isAuth?s.country:void 0,height:0,tagged_objects:a,width:0,x_coord:100*n,y_coord:100*r}});o.a.create("VisualLinkPinTagsAndObjectsResource",{pinId:t,pinTagsAndObjects:r,advertiserId:n}).callUpdate({}).catch(e=>{D(e)})})}):Promise.resolve()}}function N(e,t){return{type:"PIN_ITEM_SET_IS_TAGGABLE",payload:{pinItemId:e,isTaggable:t}}}function M(e,t){return n=>{n(Object(i.a)(e,t,{id:t,x:0,y:0})),n(v(e,t))}}function k(e,t,n){return r=>{const a=Object(f.a)();r(Object(i.a)(e,a,{id:a,x:t,y:n})),r(v(e,a))}}function U(e){const t=Object(d.e)(),n=Object(c.b)();return(i,r)=>{const a=r();i(P(e,null));t(a,{pinItemId:e}).forEach(t=>{0===n(a,{pinTagId:t}).length&&i(E(e,t))})}}},"Cdp/":function(e,t,n){n.d(t,"b",(function(){return u}));var i=n("TYy9"),r=n.n(i),a=n("rh3l"),o=n("fq7B"),s=n("l46A"),d=n("i+W5"),c=n("9KEC"),l=n("D2+t");function u(e,t){return(n,i)=>{e.forEach(e=>{const r=e.dispatchId||"",{pinbuilder:s}=i();switch(a.default.logToServer(a.default.SERVER_LOG_TYPE.ERROR,a.default.HTTP_METHOD.POST,{errorObj:{name:"React PinBuilder Exception",message:e.message,store:{pinbuilder:s}},auxData:{dispatchId:e.dispatchId,pinDraftId:t}}),Object(o.a)(e.id,e.message),e.id){case"ALT_TEXT_OVER_MAX_CHARACTER_LIMIT":n(Object(d.s)(r,e.message));break;case"BOARD_MISSING":n(Object(d.t)(r,e.message));break;case"DATE_TOO_FAR_IN_FUTURE":case"DATE_IN_PAST":case"DATE_MISSING":n(Object(d.F)(r,e.message));break;case"CAROUSEL_DIFFERENT_RATIOS":n(Object(d.q)(r,e.message));break;case"CAROUSEL_INVALID_FORMAT":case"MEDIA_MISSING":n(Object(d.A)(r,e.message));break;case"TIME_MISSING":n(Object(d.H)(r,e.message));break;case"TITLE_INVALID":n(Object(c.o)(r,e.message));break;case"DESCRIPTION_INVALID":n(Object(c.g)(r,e.message));break;case"IMAGE_IS_BLURRY":case"IMAGE_IS_SCREENSHOT":case"LINK_LOADS_SLOWLY":case"LINK_IS_AGGREGATOR":case"IMAGE_UNDER_MIN_DIMENSIONS":case"VIDEO_UNDER_MIN_DIMENSIONS":case"IMAGE_DOES_NOT_HAVE_RECOMMENDED_RATIO":n(Object(c.p)(r,{signals:{[e.id]:!0}}));break;case"TAG_INVALID":case"URL_INVALID":case"URL_IS_REDIRECT":case"URL_MISSING":case"URL_UNREACHABLE":case"URL_CONTAINS_PORN_DOMAIN":{const{pinbuilder:t}=i(),{pinDrafts:a,pinDraftIds:o}=t,s="URL_UNREACHABLE"===e.id||"URL_CONTAINS_PORN_DOMAIN"===e.id?{[e.id]:!0}:void 0;o&&"story"===a[o[0]].type?(n(Object(l.k)(r,e.message)),n(Object(l.q)(r,{isFetching:!1}))):n(Object(c.k)(r,e.message,s));break}case"STORY_PIN_COVER_PAGE_INVALID_ASPECT_RATIO":case"STORY_PIN_COVER_PAGE_TITLE_MISSING":case"STORY_PIN_TITLE_MISSING":case"STORY_PIN_NOT_ENOUGH_PAGES":case"STORY_PIN_VIDEO_ON_COVER":n(Object(d.q)(r,e.message))}})}}t.a=function(e,t,n){return(i,a)=>i(function(e,t,n){return i=>{switch(t){case"save":return i(Object(s.e)(e));case"edit":return i(Object(s.d)(e));case"publishStoryPin":return i(Object(s.c)(e));case"link":return Promise.all(i(Object(s.b)(e))).then(e=>r()(e.filter(Boolean)));case"signal":const t=n?n.fieldToCheck:null;return i(Object(s.f)(e,t)).then(e=>e.filter(Boolean));default:return Promise.resolve([])}}}(e,t,n)).then(t=>{if(t.length>0&&(i(u(t,e)),t.some(e=>e.blocking)))throw new Error;return Promise.resolve()})}},"D2+t":function(e,t,n){n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return f})),n.d(t,"n",(function(){return b})),n.d(t,"o",(function(){return h})),n.d(t,"l",(function(){return _})),n.d(t,"r",(function(){return I})),n.d(t,"q",(function(){return g})),n.d(t,"k",(function(){return y})),n.d(t,"i",(function(){return O})),n.d(t,"c",(function(){return E})),n.d(t,"m",(function(){return v})),n.d(t,"b",(function(){return j})),n.d(t,"e",(function(){return S})),n.d(t,"j",(function(){return D})),n.d(t,"h",(function(){return T})),n.d(t,"a",(function(){return w})),n.d(t,"d",(function(){return A})),n.d(t,"p",(function(){return R}));var i=n("g0hQ"),r=n("gCoO"),a=(n("eOdZ"),n("8nxc")),o=(n("Cdp/"),n("Ssxh")),s=(n("U4JR"),n("7Cbv")),d=n("M8j6"),c=n("WPUZ"),l=n("wtY2"),u=n("PM+C"),p=n("i+W5");function m(e,t){return{type:"STORY_PIN_ITEM_SET_DESCRIPTION",payload:{pinItemId:e,description:t}}}function f(e,t){return{type:"STORY_PIN_ITEM_SET_DESCRIPTION_ERROR",payload:{pinItemId:e,descriptionError:t}}}function b(e,t){return{type:"STORY_PIN_ITEM_SET_TITLE",payload:{pinItemId:e,title:t}}}function h(e,t){return{type:"STORY_PIN_ITEM_SET_TITLE_ERROR",payload:{pinItemId:e,titleError:t}}}function _(e,t){return{type:"STORY_PIN_ITEM_SET_MEDIA",payload:{pinItemId:e,media:t}}}function I(e,t){return{type:"STORY_PIN_ITEM_UPDATE_MEDIA",payload:{pinItemId:e,media:t}}}function g(e,t){return{type:"STORY_PIN_ITEM_UPDATE_LINK_BLOCK",payload:{pinItemId:e,linkBlock:t}}}function y(e,t){return{type:"STORY_PIN_ITEM_SET_LINK_ERROR",payload:{pinItemId:e,linkError:t}}}function O(e,t,n){return{type:"STORY_PIN_ITEM_SET_EDITED_IMAGE",payload:{pinItemId:e,editedMedia:t,canvasJson:n}}}function P(e,t,n){return{type:"STORY_PIN_ITEM_UPDATE_DATA",payload:{pinDraftId:e,pinItemId:t,pinItem:n}}}function E(e,t){return{type:"STORY_PIN_ITEM_SET_BLOCK_IDS",payload:{pinItemId:e,blockIds:t}}}function v(e,t){return{type:"STORY_PIN_ITEM_SET_SELECTED_BLOCK_ID",payload:{pinItemId:e,blockId:t}}}function j(e,t,n){return{type:"STORY_PIN_ITEM_SET_BACKGROUND_COLOR",payload:{pinDraftId:e,pinItemId:t,backgroundColor:n}}}function S(e,t){return{type:"STORY_PIN_ITEM_SET_COVER_IMAGE_SIGNATURE",payload:{pinItemId:e,coverImgSignature:t}}}function D(e,t,n){return{type:"STORY_PIN_ITEM_SET_LAYOUT",payload:{pinDraftId:e,pinItemId:t,layout:n}}}function T(e,t){return{type:"STORY_PIN_ITEM_SET_DOMINANT_COLORS",payload:{pinItemId:e,dominantColors:t}}}function w(e,t,n){return(a,s)=>{const l=s(),{pinDrafts:u,storyPinItemBlocks:m,storyPinItems:f}=l.pinbuilder,b=f[t].blockIds.find(e=>!!m[e].media);if(b){const{storyPinUploadManager:s}=u[e];if(a(Object(c.b)(e,t,b)),a(Object(p.y)(e,new Date)),a(Object(p.V)(e)),s){const i=Object(o.d)(t,b);s.removeMediaUpload(i),a(Object(r.a)(e,[n]))}else a(Object(d.abortPinDraftItemUpload)(e,t)),a(Object(i.a)(e,[n]))}}}function A(e,t,n,i){return(r,a)=>{const o=a(),{pinDraftIdUploadStatusMap:s}=o.pinbuilder,u="trimmedStartTime"in i,p={...i,...u?{thumbnail:i.trimmedStartTime+l.E}:{}};r(Object(c.f)(e,n,p)),u&&(s[e]&&s[e].items[t]?r(Object(d.setPinBuilderPinItemUploadStatus)(e,t,"queueEdit")):r(Object(d.addPinBuilderPinDraftItemUpload)(e,t,{status:"queueEdit",xhr:null})))}}function R(e,t,n){return i=>{if(a.a.enabled("storyPinExpressive")&&n.media){const{media:r}=n;"localImage"===r.type?i(Object(c.a)(e,t,Object(s.a)(),{media:r,edits:Object(u.e)(r),type:"story_pin_image_block"},0)):"localVideo"===r.type&&i(Object(c.a)(e,t,Object(s.a)(),{media:r,edits:Object(u.e)(r),type:"story_pin_video_block"},0));("localImage"===r.type?Object(u.f)(r):Promise.resolve([])).then(r=>i(P(e,t,{...n,backgroundColor:r.length>0?r[0]:l.m,dominantColors:r,media:null})))}else i(P(e,t,n))}}},Diiv:function(e,t,n){function i(e,t){return{type:"TAGGED_OBJECT_SET_STATUS",payload:{taggedObjectId:e,status:t}}}n.d(t,"a",(function(){return i}))},HGZT:function(e,t,n){n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return m})),n.d(t,"a",(function(){return f}));var i=n("zwad"),r=n("ZQVr"),a=n("PM+C"),o=n("wtY2"),s=n("IIK6");function d(e,t){const n=[],{title:r,description:a,linkBlock:o}=e,d=0===t;r&&n.push({type:1,level:1,text:r.substring(0,s.lb),style:{color:1}}),a&&!d&&n.push({type:0,text:a.substring(0,s.f),style:{color:1}});const{canonicalUrl:c,srcUrl:l}=o;return o&&c&&l&&!d&&n.push({type:4,text:o.text,canonical_url:o.canonicalUrl,src_url:i.a.prependHttpSchemeIfNeeded(o.srcUrl),image_signature:o.imageSignature}),n}function c(e,t){var n,i,r,a;let o;return["localImage","webImage"].includes(null===(n=e.media)||void 0===n?void 0:n.type)&&null!==(i=e.media)&&void 0!==i&&i.signature?o={image_signature:e.media.signature}:["localVideo","webVideo"].includes(null===(r=e.media)||void 0===r?void 0:r.type)&&null!==(a=e.media)&&void 0!==a&&a.signature&&(o={video_signature:e.media.signature}),{blocks:d(e,t),layout:0===t?0:1,...o}}function l(e,t,n,i,r,a=!1){const s=e.left<0&&!a?0:e.left,d=e.top<0&&!a?0:e.top;let c,l;return a?(c=n*e.scale,l=t*e.scale):(c=e.left<0?Math.min(n*e.scale+e.left,r):Math.min(r-e.left,n*e.scale),l=e.top<0?Math.min(t*e.scale+e.top,i):Math.min(i-e.top,t*e.scale)),{height:l/o.f*100,width:c/o.i*100,x_coord:s/o.i*100,y_coord:d/o.f*100}}function u(e,t,n=!1){const i=[];return e.forEach(e=>{var r,a,s,d,c;switch(e.type){case"story_pin_image_block":const _=n?null===(r=e.media)||void 0===r?void 0:r.signature:(null===(a=e.media)||void 0===a?void 0:a.signatureEdited)||(null===(s=e.media)||void 0===s?void 0:s.signature);var u,p,m;if(_)i.push({block_style:l(e.edits,(null===(u=e.media)||void 0===u?void 0:u.height)||0,(null===(p=e.media)||void 0===p?void 0:p.width)||0,3===t?o.f/2:o.f,o.i,n),image_signature:_,tracking_id:"localImage"===(null===(m=e.media)||void 0===m?void 0:m.type)?e.media.uploadId:void 0,type:2});break;case"story_pin_video_block":const I=(null===(d=e.media)||void 0===d?void 0:d.signatureEdited)||(null===(c=e.media)||void 0===c?void 0:c.signature);var f,b,h;if(I)i.push({block_style:l(e.edits,(null===(f=e.media)||void 0===f?void 0:f.height)||0,(null===(b=e.media)||void 0===b?void 0:b.width)||0,3===t?o.f/2:o.f,o.i,!0),tracking_id:"localVideo"===(null===(h=e.media)||void 0===h?void 0:h.type)?e.media.uploadId:void 0,video_signature:I,type:3});break;case"story_pin_paragraph_block":(n||e.text)&&i.push({block_style:e.blockStyle,style:{...e.style,vertical_alignment:0},text:e.text,type:0});break;case"story_pin_heading_block":(n||e.text)&&i.push({block_style:e.blockStyle,style:{...e.style,vertical_alignment:0},text:e.text,type:1})}}),i}function p(e,t){const{layout:n}=e;return null!=n?{blocks:u(t,n,!0),layout:n,style:{background_color:e.backgroundColor}}:null}function m(e,t,n){const{layout:i}=e;return t&&t.length&&null!=i?{blocks:u(t,i),layout:0===n?0:i,style:{background_color:e.backgroundColor}}:null}function f(e,t,n=7,i,s,d){return new Promise((c,l)=>{const u=Object(a.d)(t,e.height,e.width,n,!!d),p=document.createElement("canvas"),m=p.getContext("2d"),f=-1===t.transform.scaleX,b=-1===t.transform.scaleY;p.height=u.fullCanvasHeight,p.width=u.fullCanvasWidth,i&&s&&(m.beginPath(),m.rect(0,0,u.fullCanvasWidth,u.fullCanvasHeight),m.fillStyle=s,m.fill()),m.save();const h=document.createElement("img");h.onload=()=>{if(m.scale(t.transform.scaleX,t.transform.scaleY),m.drawImage(h,u.image.x,u.image.y,u.image.width,u.image.height,f?-1*(u.canvas.x+u.image.width):u.canvas.x,b?-1*(u.canvas.y+u.image.height):u.canvas.y,u.canvas.width,u.canvas.height),m.restore(),i&&i.style&&i.blockStyle&&i.font){var n;const{font:e,text:t,blockStyle:{width:r=100,x_coord:c=0,y_coord:l=0},style:{alignment:p=0,font_size:f,hex_color:b,highlight_color:h=null}}=i,_=null!=f?f:24,I=null!=b?b:"#FFFFFF";m.font=`${_}px ${null!==(n=e.fontFamily)&&void 0!==n?n:""}`;const g=Object(a.b)(t,o.i*(r/100),m);if(g.length){var s,d;const t=u.fullCanvasWidth/o.i;m.font=`${_*t}px ${null!==(s=e.fontFamily)&&void 0!==s?s:""}`,m.textAlign=0===p?"left":"center",m.textBaseline="top";const n=0===p?c/100*o.i*t:c/100*o.i*t+r/100*o.i*t/2,i=_*t*Math.max((null===(d=e.fontOverrides)||void 0===d?void 0:d.lineHeight)||1.1);let f=l/100*u.fullCanvasHeight+(i-_*t);if(h){let e=f;g.forEach(r=>{const o=_*t,s=0===p?n:n-r.width/2*t,d=.05*o,c=.2*o;r.text&&r.text.length>0&&Object(a.c)(m,s-c,e-d,r.width*t+2*c,o+2*d,5,h),e+=i})}m.fillStyle=I,"#ffffff"===I.toLowerCase()&&(m.shadowColor="rgba(0, 0, 0, 0.2)",m.shadowOffsetY=1,m.shadowBlur=4),g.forEach(e=>{m.fillText(e.text,n,f),f+=i})}}const l=p.toDataURL();c({height:p.height,id:e.id,name:e.name,size:Object(r.a)(l).size,src:l,type:"localImage",width:p.width})},h.src=e.src})}},HaiL:function(e,t,n){n.d(t,"a",(function(){return m}));var i=n("Ye/N"),r=n("nj6m"),a=n("QAzJ"),o=n("n6mq"),s=n("w70y"),d=n("nKUr");const c=Object(s.b)({name:"PinResource",key:"detailedPin",options:({pinId:e})=>({id:e,field_set_key:"detailed"})})((function({detailedPin:e}){const{data:t}=e,n=t&&t.story_pin_data?t.story_pin_data.page_count:null,r=Object(a.a)("web_sp2s")().anyEnabled;return Object(d.jsxs)(o.f,{display:"flex",alignItems:"center",height:20,children:[Object(d.jsx)(o.v,{dangerouslySetSvgPath:{__path:"M21,17.6119404 L21,9.15332448 C21,7.0136795 20.7772185,6.23779253 20.3588815,5.45557032 C19.9405445,4.67334809 19.3266519,4.05945552 18.5444297,3.64111848 C17.7622075,3.22278146 16.9863205,3 14.8466755,3 L6.3880595,3 C6.46224202,2.80834445 6.54669936,2.63211874 6.64111848,2.45557032 C7.05945552,1.67334809 7.67334809,1.05945552 8.45557032,0.64111848 C9.23779253,0.222781464 10.0136795,0 12.1533245,0 L17.8466755,0 C19.9863205,0 20.7622075,0.222781464 21.5444297,0.64111848 C22.3266519,1.05945552 22.9405445,1.67334809 23.3588815,2.45557032 C23.7772185,3.23779253 24,4.0136795 24,6.15332448 L24,11.8466755 C24,13.9863205 23.7772185,14.7622075 23.3588815,15.5444297 C22.9405445,16.3266519 22.3266519,16.9405445 21.5444297,17.3588815 C21.3678813,17.4533006 21.1916556,17.5377581 21,17.6119404 Z M6.15332448,6 L11.8466755,6 C13.9863205,6 14.7622075,6.22278146 15.5444297,6.64111848 C16.3266519,7.05945552 16.9405445,7.67334809 17.3588815,8.45557032 C17.7772185,9.23779253 18,10.0136795 18,12.1533245 L18,17.8466755 C18,19.9863204 17.7772185,20.7622075 17.3588815,21.5444297 C16.9405445,22.3266518 16.3266519,22.9405445 15.5444297,23.3588815 C14.7622075,23.7772186 13.9863205,24 11.8466755,24 L6.15332448,24 C4.0136795,24 3.23779253,23.7772186 2.45557032,23.3588815 C1.67334809,22.9405445 1.05945551,22.3266518 0.64111849,21.5444297 C0.222781467,20.7622075 0,19.9863204 0,17.8466755 L0,12.1533245 C0,10.0136795 0.222781467,9.23779253 0.64111849,8.45557032 C1.05945551,7.67334809 1.67334809,7.05945552 2.45557032,6.64111848 C3.23779253,6.22278146 4.0136795,6 6.15332448,6 Z"},accessibilityLabel:r?i.a._("Idea Pin Icon","legacyPinTypeIdentifier.ideaPinAccessibilityLabel","Icon indicating this Pin is an Idea Pin"):i.a._("Story Pin Icon","Icon indicating this Pin is a story","Icon indicating this Pin is a story"),size:12,color:"darkGray"}),n&&Object(d.jsx)(o.f,{marginStart:1,children:Object(d.jsx)(o.cb,{inline:!0,size:"sm",weight:"bold",children:n})})]})}));function l({color:e="#333",height:t}){const n=14*t/10;return Object(d.jsx)("svg",{width:n,height:t,viewBox:"3 3 18 18",xmlns:"http://www.w3.org/2000/svg",children:Object(d.jsx)("path",{fill:e,d:"M20.571 8.573h-3.428V12h1.714v1.715h-1.714v3.428h-1.714V6.86h5.142v1.714zM12 17.144V6.86h1.714v10.285H12zm-1.714-8.571H5.143v6.857H8.57v-1.714H6.857V12h3.429v5.143H3.429V6.86h6.857v1.714zM5.143 3.43A5.143 5.143 0 0 0 0 8.573v6.857a5.143 5.143 0 0 0 5.143 5.143h13.714A5.143 5.143 0 0 0 24 15.43V8.573a5.143 5.143 0 0 0-5.143-5.143H5.143z"})})}const u={__path:"M6 5h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm8 0h5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm0 8h5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1v-5a1 1 0 0 1 1-1z"},p=(e,t)=>{switch(e){case"arrow-up-right":return i.a._("Promoted Pin","Icon indicating this Pin is promoted","Icon indicating this Pin is promoted");case"play":return i.a._("Video Pin","Icon indicating this Pin is a video","Icon indicating this Pin is a video");case"gif":return i.a._("GIF Pin","Icon indicating this Pin is a GIF","Icon indicating this Pin is a GIF");case"tag":return i.a._("Product Pin","Icon indicating this Pin is a product","Icon indicating this Pin is a product");case"star":return i.a._("Recipe Pin","Icon indicating this Pin is a recipe","Icon indicating this Pin is a recipe");case"story-pin":return t?i.a._("Idea Pin","legacyPinTypeIdentifier.getLabel.ideaPinLabel","Icon indicating this Pin is an Idea Pin"):i.a._("Story Pin","Icon indicating this Pin is a story","Icon indicating this Pin is a story");case"collage":return i.a._("Collage Pin","Icon indicating this Pin is a collage","Icon indicating this Pin is a collage");default:return""}};function m({max_rating:e,icon:t,text:n,rating:i,pinId:s}){const{anyEnabled:m}=Object(a.a)("web_sp2s")({dangerouslySkipActivation:!0});let f;if(t)switch(t){case"star":f=Object(d.jsx)(r.a,{rating:i||"",max_rating:e,width:10});break;case"gif":f=Object(d.jsx)(l,{height:10,color:"#333"});break;case"story-pin":f=Object(d.jsx)(c,{pinId:s});break;default:f=Object(d.jsx)(o.f,{display:"flex",alignItems:"center",marginEnd:1,children:Object(d.jsx)(o.v,{dangerouslySetSvgPath:"collage"===t?u:void 0,icon:"collage"===t?void 0:t,accessibilityLabel:p(t,m),color:"darkGray",size:10,inline:!0})})}return Object(d.jsxs)(o.f,{display:"flex",alignItems:"center",children:[f,n&&Object(d.jsx)(o.f,{marginStart:1,children:Object(d.jsx)(o.cb,{inline:!0,size:"md",children:n.trim().substring(0,25)})})]})}},JMvu:function(e,t,n){n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));function i(e,t,n){return new Promise(i=>{const r=document.createElement("video");let a;const o=()=>{const e=r.seekable.length;e&&r.seekable.end(e-1)>=t&&(window.clearInterval(a),r.currentTime=t)};r.addEventListener("loadedmetadata",()=>{a=window.setInterval(o,50)}),r.addEventListener("seeked",()=>{const{x:e,y:t,width:a,height:o}=n||{x:0,y:0,width:r.videoWidth,height:r.videoHeight},s=document.createElement("canvas");s.height=o,s.width=a;s.getContext("2d").drawImage(r,e,t,s.width,s.height,0,0,s.width,s.height),i(s.toDataURL())}),r.src=e.src})}function r(e,t){return new Promise(n=>{const i=document.createElement("img");i.onload=function(){const{x:e,y:r,width:a,height:o}=t||{x:0,y:0,width:i.width,height:i.height},s=document.createElement("canvas");s.height=o,s.width=a;s.getContext("2d").drawImage(i,e,r,s.width,s.height,0,0,s.width,s.height),n(s.toDataURL())},i.src=e})}},Kd7H:function(e,t,n){n.d(t,"a",(function(){return r}));var i=n("zwad");function r(e){if(e.isAuth&&e.isPartner){return"partner_upload_"+(i.a.getCurrentPath().includes("/create/")?"create_flow":"standalone")}return"pinner_upload_standalone"}},M8j6:function(e,t,n){n.r(t),n.d(t,"clearPinBuilderPinDrafts",(function(){return h})),n.d(t,"deletePinDraft",(function(){return _})),n.d(t,"duplicatePinDraft",(function(){return I})),n.d(t,"selectPinBuilderPinDraft",(function(){return g})),n.d(t,"deselectPinBuilderPinDraft",(function(){return y})),n.d(t,"clearSelectedPinBuilderPinDrafts",(function(){return O})),n.d(t,"deleteSelectedPinBuilderPinDrafts",(function(){return P})),n.d(t,"publishSelectedPinBuilderPinDrafts",(function(){return E})),n.d(t,"publishAllPinBuilderPinDrafts",(function(){return v})),n.d(t,"selectAllPinBuilderPinDrafts",(function(){return j})),n.d(t,"deselectAllPinBuilderPinDrafts",(function(){return S})),n.d(t,"setPinBuilderSharedData",(function(){return D})),n.d(t,"addPinBuilderAsset",(function(){return T})),n.d(t,"createPinDraftsFromAssets",(function(){return A})),n.d(t,"createLayoutPinDraftFromAssets",(function(){return R})),n.d(t,"addAssetsToPinDraft",(function(){return N})),n.d(t,"setPinBuilderFailureErrorLogged",(function(){return M})),n.d(t,"setPinBuilderLayoutMode",(function(){return k})),n.d(t,"setPinBuilderBatchEditMode",(function(){return U})),n.d(t,"setPinEditorPinDraft",(function(){return C})),n.d(t,"addPinBuilderPinDraftItemUpload",(function(){return x})),n.d(t,"setPinBuilderPinDraftUploadStatus",(function(){return L})),n.d(t,"setPinBuilderPinItemUploadStatus",(function(){return B})),n.d(t,"setPinBuilderPinItemUploadXhr",(function(){return F})),n.d(t,"removePinBuilderPinItemUpload",(function(){return V})),n.d(t,"removePinBuilderPinDraftUpload",(function(){return z})),n.d(t,"clearPinBuilderPinDraftUpload",(function(){return G})),n.d(t,"abortPinDraftItemUpload",(function(){return H})),n.d(t,"addCreatedPinId",(function(){return Y})),n.d(t,"removeCreatedPinId",(function(){return W})),n.d(t,"clearCreatedPinIds",(function(){return q})),n.d(t,"setCloseupImageSignature",(function(){return K})),n.d(t,"setPinBuilderEntryPoint",(function(){return J}));var i=n("8mez"),r=n("s95B"),a=n("UkA3"),o=n("3bT9"),s=n("/vtw"),d=n("m4CH"),c=n("f+bf"),l=n("Glit"),u=n("03SQ"),p=n("9KEC"),m=n("7Cbv"),f=n("IIK6"),b=n("i+W5");function h(){return{type:"PIN_BUILDER_CLEAR_PIN_DRAFTS"}}function _(e){return(t,n)=>{const i=n(),{pinDraftIds:r}=i.pinbuilder;t(Object(c.a)(e)),r.length<=1&&t(Object(a.a)(Object(m.a)()))}}function I(e){return(t,n)=>{const a=n(),{pinDrafts:o,pinItems:s}=a.pinbuilder,d=o[e],c=Object(m.a)(),l=d.pinItemIds.map(e=>{const n=Object(m.a)();return t(Object(r.a)(c,n,s[e])),n});t(Object(i.a)(c,{...d,pinItemIds:l},{insertBefore:e}))}}function g(e){return{type:"PIN_BUILDER_SELECT_PIN_DRAFT",payload:{pinDraftId:e}}}function y(e){return{type:"PIN_BUILDER_DESELECT_PIN_DRAFT",payload:{pinDraftId:e}}}function O(){return{type:"PIN_BUILDER_CLEAR_SELECTED_PIN_DRAFTS"}}function P(){return(e,t)=>{const{pinbuilder:n}=t(),{pinDraftIds:i,selectedPinDraftIds:r}=n;r.forEach(t=>{e(y(t)),e(Object(c.a)(t))}),r.length===i.length&&e(Object(a.a)(Object(m.a)()))}}function E(){return(e,t)=>{const{pinbuilder:n}=t(),{selectedPinDraftIds:i}=n;i.forEach(t=>{e(y(t)),e(Object(b.o)({pinDraftId:t}))})}}function v(){return(e,t)=>{const{pinbuilder:n}=t(),{pinDrafts:i,pinDraftIds:r}=n;for(const a of r){const{status:t}=i[a];"succeeded"!==t&&(e(y(a)),e(Object(b.o)({pinDraftId:a})))}}}function j(){return(e,t)=>{const{pinbuilder:n}=t(),{selectedPinDraftIds:i,pinDrafts:r,pinDraftIds:a}=n;a.forEach(t=>{const{status:n}=r[t];i.includes(t)||f.nb.includes(n)||e(g(t))})}}function S(){return(e,t)=>{const{pinbuilder:n}=t(),{selectedPinDraftIds:i}=n;i.forEach(t=>{e(y(t))})}}function D(e){return(t,n)=>{const i=n(),{selectedPinDraftIds:r}=i.pinbuilder,{publishOption:a,scheduledDate:o,scheduledTime:s,selectedItem:d,...c}=e;r.forEach(e=>{t(Object(b.U)(e,{...null!=a?{publishOption:a}:Object.freeze({}),...void 0!==d?{selectedItem:d}:Object.freeze({}),...void 0!==o?{scheduledDate:o}:Object.freeze({}),...void 0!==s?{scheduledTime:s}:{}})),c.editorInstanceId=Object(m.a)(),t(Object(b.K)(e,c))})}}function T(e){return{type:"PIN_BUILDER_ADD_ASSET",payload:{asset:e}}}function w(e,t){const{pinDrafts:n,pinItems:i}=e.pinbuilder,{selectedItem:r,pinItemIds:a,publishOption:o}=n[t];return!r&&"publish-immediately"===o&&a.every(e=>{const{description:t,link:n,media:r,title:a}=i[e];return!(t||n||a||r)})}function A(e){return(t,n)=>{const i=n(),{pinDraftIds:o}=i.pinbuilder;e.concat().reverse().reduce((e,n)=>e.then(()=>{const e=Object(m.a)(),i=Object(m.a)();"localImage"!==n.type&&"webImage"!==n.type&&"localVideo"!==n.type||(t(Object(r.a)(e,i,{media:n,..."webImage"===n.type?{link:n.sourceURL}:{}})),"localVideo"===n.type&&t(Object(u.c)(e,i))),t(Object(a.a)(e,{pinItemIds:[i]}))}),Promise.resolve()).then(()=>{const e=o.findIndex(e=>!w(i,e));o.slice(0,e>=0?e:void 0).forEach(e=>t(Object(c.a)(e)))})}}function R(e){return(t,n)=>{const i=n(),{pinDraftIds:o}=i.pinbuilder;Object(s.a)(e).then(({media:e,canvasJson:n})=>{const i=Object(m.a)(),o=Object(m.a)();t(Object(r.a)(i,o,{media:{...e,id:Object(m.a)(),name:"",type:"localImage",isLayout:!0},canvasJson:n})),t(Object(a.a)(i,{pinItemIds:[o]}))}).then(()=>{const e=o.findIndex(e=>!w(i,e));o.slice(0,e>=0?e:void 0).forEach(e=>t(Object(c.a)(e)))})}}function N(e,t){return(n,i)=>{const s=i(),c=t||Object(m.a)(),u=s.pinbuilder.pinDrafts[c]&&s.pinbuilder.pinDrafts[c].pinItemIds||[],b=u.length,{media:h}=s.pinbuilder.pinItems[u[0]]||{},_=s.pinbuilder.pinItems[u[b-1]],{width:I,height:g}=e.length>0&&"localImage"===e[0].type?e[0]:{},y=u[b-1],O=e.reduce((e,t,n)=>(e.push(Object(m.a)()),e),_?[y]:[]),P=Object(d.a)(h&&h.width||I,h&&h.height||g),E=0===b?b:b-1,v=e.slice(0,f.D-E).reduce((e,t)=>({...e,[Object(m.a)()]:{...l.b,media:"localImage"===t.type?t:null}}),{});Object(o.a)(Object.keys(v),v,P).then(e=>{const i=e.map((e,t)=>{const i=O[t]||Object(m.a)();return n(i===y?Object(p.p)(i,e):Object(r.a)(c,i,e)),i});if(e.length+E<f.D){const e=Object(m.a)();n(Object(r.a)(c,e,null,{saveIndex:!0})),i.push(e)}t||n(Object(a.a)(c,{pinItemIds:i}))})}}function M(e){return{type:"PIN_BUILDER_SET_FAILURE_ERROR_LOGGED",payload:{failureErrorLogged:e}}}function k(e){return{type:"PIN_BUILDER_SET_LAYOUT_MODE",payload:{layoutMode:e}}}function U(e){return{type:"PIN_BUILDER_SET_BATCH_EDIT_MODE",payload:{isBatchEditMode:e}}}function C(e){return{type:"PIN_EDITOR_SET_PIN_DRAFT",payload:{editedPinDraftId:e}}}function x(e,t,n){return{type:"PIN_BUILDER_ADD_PIN_DRAFT_ITEM_UPLOAD",payload:{pinDraftId:e,pinItemId:t,upload:n}}}function L(e,t){return{type:"PIN_BUILDER_SET_PIN_DRAFT_UPLOAD_STATUS",payload:{pinDraftId:e,status:t}}}function B(e,t,n){return{type:"PIN_BUILDER_SET_PIN_ITEM_UPLOAD_STATUS",payload:{pinDraftId:e,pinItemId:t,status:n}}}function F(e,t,n){return{type:"PIN_BUILDER_SET_PIN_ITEM_UPLOAD_XHR",payload:{pinDraftId:e,pinItemId:t,xhr:n}}}function V(e,t){return{type:"PIN_BUILDER_REMOVE_PIN_ITEM_UPLOAD",payload:{pinDraftId:e,pinItemId:t}}}function z(e){return{type:"PIN_BUILDER_REMOVE_PIN_DRAFT_UPLOAD",payload:{pinDraftId:e}}}function G(){return{type:"PIN_BUILDER_CLEAR_PIN_DRAFT_UPLOAD"}}function H(e,t){return(n,i)=>{const r=i(),{pinDraftIdUploadStatusMap:a}=r.pinbuilder,o=a[e];o&&o.items[t]&&o.items[t].xhr&&(o.items[t].xhr.abort(),Object.keys(o.items).length<=1?n(z(e)):n(V(e,t)))}}function Y(e){return{type:"PIN_BUILDER_ADD_CREATED_PIN_ID",payload:{pinId:e}}}function W(e){return{type:"PIN_BUILDER_REMOVE_CREATED_PIN_ID",payload:{pinId:e}}}function q(){return{type:"PIN_BUILDER_CLEAR_CREATED_PIN_IDS"}}function K(e){return{type:"PIN_BUILDER_SET_CLOSEUP_IMAGE_SIGNATURE",payload:{closeupImageSignature:e}}}function J(e){return{type:"PIN_BUILDER_ENTRY_POINT",payload:{entryPoint:e}}}},NZVI:function(e,t,n){function i(e,t,n){return{type:"PIN_ITEM_ADD_PIN_TAG",payload:{pinItemId:e,pinTagId:t,pinTag:n}}}n.d(t,"a",(function(){return i}))},"PM+C":function(e,t,n){n.d(t,"g",(function(){return d})),n.d(t,"f",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return f}));n("q1tI");var i=n("dx7t"),r=n.n(i),a=n("ZVWG"),o=n("fDVu"),s=n("wtY2");function d(e){return["#111111","#370052","#00205C","#01564C","#363F03","#573700","#5E031A","#97026D","#8000BD","#0045CC"][e]}function c(e,t=5){return"undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.body&&window.document.body?new Promise(n=>{const{height:i,src:a,width:o}=e,s=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t},d=document.createElement("canvas");d.width=o,d.height=i;const c=document.createElement("img");c.onload=()=>{const e=d.getContext("2d");e.drawImage(c,0,0);const a=e.getImageData(0,0,o,i).data,l=[],u=o*i;for(let t=0;t<u;t+=10){const e=4*t;l.push([a[e],a[e+1],a[e+2]])}const p=r()(l,t).palette();d.remove(),c.remove(),n(p.map(e=>{return t=e[0],n=e[1],i=e[2],"#"+s(t)+s(n)+s(i);var t,n,i}))},c.src=a}):Promise.reject([])}function l(e,t){if(!t)return{left:0,scale:1,top:0,transform:{rotate:0,scaleX:1,scaleY:1}};const{height:n=100,width:i=100,x_coord:r=0,y_coord:a=0}=t;let o;return o=e.width>e.height?s.i/e.width*(i/100):s.f/e.height*(n/100),{left:r?r/100*s.i:0,scale:o,top:a?a/100*s.f:0,transform:{rotate:0,scaleX:1,scaleY:1}}}function u(e){if(e.width/e.height<s.d){const t=s.i/e.width,n=e.height*t;return{scale:t,top:(s.f-n)/2,left:0,transform:{rotate:0,scaleX:1,scaleY:1}}}{const t=s.f/e.height,n=e.width*t;return{left:(s.i-n)/2,scale:t,top:0,transform:{rotate:0,scaleX:1,scaleY:1}}}}function p(e,t,n){const i=e.split(/\r?\n/g),r=[];let o="";const s=e=>{const t=e.trim();return{text:t,width:n.measureText(t).width}},d=e=>{const i=!!e.match(/\s/),a=0===o.length;if(n.measureText(`${o}${e}`).width>t)if(i)r.push(s(o)),o="";else if(a)for(const t of e)d(t);else r.push(s(o)),o="",d(e);else o+=e};for(const c of i){0===c.length&&r.push(s(o));Object(a.b)(c).forEach(e=>d(e)),o.length&&(r.push(s(o)),o="")}return r}function m(e,t,n,i,r,a,o){e.beginPath(),e.moveTo(t+a,n),e.lineTo(t+i-a,n),e.quadraticCurveTo(t+i,n,t+i,n+a),e.lineTo(t+i,n+r-a),e.quadraticCurveTo(t+i,n+r,t+i-a,n+r),e.lineTo(t+a,n+r),e.quadraticCurveTo(t,n+r,t,n+r-a),e.lineTo(t,n+a),e.quadraticCurveTo(t,n,t+a,n),e.closePath(),e.fillStyle=o,e.fill()}function f(e,t,n,i,r){const{left:a,scale:d,top:c}=e,l=3===i?s.f/2:s.f,u=a<0?Math.min(n*d+a,s.i):Math.min(s.i-a,n*d),p=c<0?Math.min(t*d+c,l):Math.min(l-c,t*d),m=u/(n*d),f=p/(t*d),b=r?Math.max(s.i/d,s.i):m*n,h=r?Math.max(s.f/d,s.f):f*t,_=u/s.i,I=r?_*b:m*n,g=r?p/l*(3===i?h/2:h):f*t;let y=1;return(b<o.d||h<o.d)&&(b*y<o.d&&(y=o.d/b),h*y<o.d&&(y=o.d/h)),{fullCanvasHeight:h*y,fullCanvasWidth:b*y,canvas:{height:g*y,width:I*y,x:a<0||!r?0:a/d*y,y:c<0||!r?0:c/d*y},image:{height:f*t,width:m*n,x:a<0?Math.abs(a)/d:0,y:c<0?Math.abs(c)/d:0}}}},RjJ5:function(e,t,n){n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));const i=6e3,r=e=>{const t=Math.floor(100*e||0),n=Math.floor(t/i),r=Math.floor((t-n*i)/100),a=t-n*i-100*r;return`${n<10?"0"+n:n}:${r<10?"0"+r:r}:${a<10?"0"+a:a}`},a=e=>`00:${r(e).substring(0,5)}:00`,o=e=>{const t=e.split(":");let n=0;return 3===t.length&&(n+=isNaN(t[0])?0:60*+t[0],n+=isNaN(t[1])?0:+t[1],n+=isNaN(t[2])?0:+t[2]/100),n}},Ssxh:function(e,t,n){n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return c}));var i=n("D2+t"),r=n("WPUZ"),a=n("8h0Y");const o=(e,t)=>`${e}-${t}`;function s(e,t,n,i,s=!1,d){return(c,l)=>{const u=l(),{pinbuilder:p,viewer:m}=u,{pinDrafts:f}=p,b=f[e].storyPinUploadManager,h=m.isAuth&&m.isEmployee;if(b){const l=o(t,n),u=f[e].pinItemIds.findIndex(e=>t===e);h&&console.log("[ADD IMAGE UPLOAD] - Adding upload with ID and isDraft",l,s);let p=0;b.addMediaUpload(i,l,"pinimage",{onFailure:s?()=>{}:({uploadId:t,errorMsg:n,mediaStatusFailureReason:r,mediaUploadFailureReason:o})=>Object(a.c)({errorMsg:n,pinDraftId:e,mediaUploadFailureReason:o,mediaStatusFailureReason:r,uploadId:t,fileSizeBytes:i.size,storyPageNumber:u,storyPinPublishStopwatch:d}),onFinishUpload:s?void 0:(e,{uploadTimeSec:t})=>p=t,onFinishProcessing:(t,{processingTimeSec:o,signature:m})=>{h&&console.log("[ADD IMAGE UPLOAD] - Setting signature with ID and isDraft",l,s);const f={uploadId:t,...s?{signature:m}:{signatureEdited:m}};c(Object(r.f)(e,n,f)),s||Object(a.e)({pinDraftId:e,uploadId:t,fileSizeBytes:i.size,imageSig:m,storyPageNumber:u,uploadTimeSec:p+o,storyPinPublishStopwatch:d})},onStartUpload:s?void 0:t=>Object(a.h)({pinDraftId:e,uploadId:t,fileSizeBytes:i.size,storyPageNumber:u,storyPinPublishStopwatch:d})})}}}function d(e,t,n,i,s){return(d,c)=>{const l=c(),{pinbuilder:u,viewer:p}=l,{pinDrafts:m}=u,f=m[e].storyPinUploadManager,b=p.isAuth&&p.isEmployee;if(f){const c=o(t,n),l=m[e].pinItemIds.findIndex(e=>t===e);b&&console.log("[ADD VIDEO UPLOAD] - Adding upload with ID and isDraft",c),f.addMediaUpload(i,c,"video-story-pin",{onFailure:(e,t,n)=>Object(a.d)({errorMessage:t,mediaUploadFailureReason:n,uploadId:e,fileSizeBytes:i.size,storyPageNumber:l,videoDuration:i.duration,storyPinPublishStopwatch:s}),onFinishProcessing:(t,{processingTimeSec:o,signature:u})=>{b&&console.log("[ADD VIDEO UPLOAD] - Setting signature from finish processing",c),d(Object(r.f)(e,n,{uploadId:t,signature:u})),Object(a.f)({processingTimeSec:o,signature:u,uploadId:t,fileSizeBytes:i.size,storyPageNumber:l,videoDuration:i.duration,storyPinPublishStopwatch:s})},onFinishUpload:(e,t)=>Object(a.g)({uploadId:e,amzId2:t.amzId2,amzRequestId:t.amzRequestId,fileSizeBytes:i.size,statusCode:t.statusCode,storyPageNumber:l,uploadTimeSec:t.uploadTimeSec,videoDuration:i.duration,storyPinPublishStopwatch:s}),onStartProcessing:(t,{signature:o})=>{b&&console.log("[ADD VIDEO UPLOAD] - Setting signature from start processing",c),d(Object(r.f)(e,n,{uploadId:t,signature:o})),Object(a.i)({signature:o,uploadId:t,fileSizeBytes:i.size,storyPageNumber:l,videoDuration:i.duration,storyPinPublishStopwatch:s})},onStartUpload:e=>Object(a.j)({uploadId:e,fileSizeBytes:i.size,storyPageNumber:l,videoDuration:i.duration,storyPinPublishStopwatch:s}),onUploadProgress:t=>d(Object(r.f)(e,n,{uploadProgress:t}))})}}}function c(e,t){return(n,r)=>{const a=r(),{pinbuilder:o,viewer:s}=a,{pinDrafts:d}=o,{pinItemIds:c,storyPinUploadManager:l}=d[e],u=s.isAuth&&s.isEmployee;if(l){const r=e+"-coverImage";l.addMediaUpload(t,r,"pinimage",{onFailure:()=>{},onFinishProcessing:(e,{signature:t})=>{u&&console.log("[ADD COVER IMAGE UPLOAD] - Setting signature",r),n(Object(i.e)(c[0],t))}})}}}},UkA3:function(e,t,n){n.d(t,"a",(function(){return d}));var i=n("8mez"),r=n("s95B"),a=n("qfnd"),o=n("yRuA"),s=n("7Cbv");function d(e,t,n){return d=>{if(!t||!t.pinItemIds){const n=Object(s.a)();d((t&&"story"===t.type?a.a:r.a)(e,n))}"story"===(null==t?void 0:t.type)&&d(Object(o.a)(e,n)),d(Object(i.a)(e,t))}}},VW7W:function(e,t,n){n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"d",(function(){return m})),n.d(t,"a",(function(){return f}));var i=n("MhBu"),r=n("7w6Q"),a=n("eOdZ"),o=n("8nxc");var s=n("HxmZ"),d=n("WPUZ"),c=n("D2+t"),l=n("y7BG");function u(e){return(t,n)=>{const i=n(),{pinDrafts:r,storyPinItemBlocks:a,storyPinItems:u}=i.pinbuilder,p=o.a.enabled("storyPinExpressive");return new Promise((n,o)=>Promise.all(r[e].pinItemIds.map((n,r)=>p?((n,r)=>{var o;const{layout:c}=u[n],p=Object(s.b)(i,{pinItemId:n},"story_pin_image_block"),m=p?a[p]:null;if(p&&m&&"localImage"===(null===(o=m.media)||void 0===o?void 0:o.type)&&m.media.signatureEdited){const n=m.media;return Object(l.b)(n,m.edits,e,r,c).then(({signature:n,uploadId:i})=>t(Object(d.f)(e,p,{uploadId:i,signatureEdited:n})))}return Promise.resolve()})(n,r):(e=>{var n;const i=u[e];return"localImage"===(null===(n=i.media)||void 0===n?void 0:n.type)?Object(l.c)(i.media).then(n=>t(Object(c.r)(e,{signature:n}))):Promise.resolve()})(n))).then(()=>n()).catch(e=>o(e)))}}function p(e){return(t,n)=>{const i=n(),{fonts:r,pinDrafts:a,storyPinItemBlocks:s,storyPinItems:d}=i.pinbuilder;return o.a.enabled("storyPinExpressive")?(()=>{const n=a[e].pinItemIds.length>0?a[e].pinItemIds[0]:null,i=n&&d[n];if(n&&i&&!i.coverImgSignature){const{backgroundColor:a,blockIds:o,layout:d}=i,u=o.map(e=>s[e]);return u.find(e=>{var t;return["localImage","localVideo"].includes(null===(t=e.media)||void 0===t?void 0:t.type)})?Object(l.a)(u,a,r,e,d).then(({signature:e})=>t(Object(c.e)(n,e))):Promise.resolve()}return Promise.resolve()})():Promise.resolve()}}function m(e,t){return(n,i)=>{var r;const a=i(),{pinDrafts:o,storyPinItemBlocks:s,storyPinItems:c}=a.pinbuilder,u=o[e].pinItemIds.findIndex(e=>e===t),p=c[t].blockIds.find(e=>{var t;return"localImage"===(null===(t=s[e].media)||void 0===t?void 0:t.type)});if(p&&"localImage"===(null===(r=s[p].media)||void 0===r?void 0:r.type)){const t=s[p].media;Object(l.d)(t.src,e,u).then(({signature:t,uploadId:i})=>n(Object(d.f)(e,p,{signature:t,uploadId:i})))}}}function f(e){return(t,n)=>{const o=n(),{viewer:s}=o;return s.isAuth?new Promise((n,o)=>{a.a.create("ApiResource",{url:`/v3/storypins/drafts/${e}/`}).callDelete().then(()=>{t(Object(i.a)({feedType:"storyPinData",feedId:s.id,itemIds:[e],itemType:"storypindata"})),t(function(e){return{type:"STORY_PIN_DATA_DELETE",payload:{storyPinDataId:e}}}(e)),n()}).catch(e=>{r.a.increment("story_pin.drafts.delete.failure",1,{app_type:"web"}),o(new Error("Unable to delete the draft"))})}):Promise.resolve()}}},WPUZ:function(e,t,n){function i(e,t,n,i,r){return{type:"STORY_PIN_ITEM_ADD_BLOCK",payload:{pinDraftId:e,pinItemId:t,blockId:n,storyPinItemBlock:i,index:r}}}function r(e,t,n){return{type:"STORY_PIN_ITEM_BLOCK_UPDATE_EDITS",payload:{pinDraftId:e,blockId:t,edits:n}}}function a(e,t,n){return{type:"STORY_PIN_ITEM_BLOCK_UPDATE_MEDIA",payload:{pinDraftId:e,blockId:t,media:n}}}function o(e,t){return{type:"STORY_PIN_ITEM_BLOCK_SET_PLAYING",payload:{blockId:e,playing:t}}}function s(e,t,n){return{type:"STORY_PIN_ITEM_REMOVE_BLOCK",payload:{pinDraftId:e,pinItemId:t,blockId:n}}}function d(e,t,n){return{type:"STORY_PIN_ITEM_UPDATE_BLOCK",payload:{pinDraftId:e,blockId:t,storyPinItemBlock:n}}}n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return d}))},dx7t:function(e,t){if(!n)var n={map:function(e,t){var n={};return t?e.map((function(e,i){return n.index=i,t.call(n,e)})):e.slice()},naturalOrder:function(e,t){return e<t?-1:e>t?1:0},sum:function(e,t){var n={};return e.reduce(t?function(e,i,r){return n.index=r,e+t.call(n,i)}:function(e,t){return e+t},0)},max:function(e,t){return Math.max.apply(null,t?n.map(e,t):e)}};var i=function(){function e(e,t,n){return(e<<10)+(t<<5)+n}function t(e){var t=[],n=!1;function i(){t.sort(e),n=!0}return{push:function(e){t.push(e),n=!1},peek:function(e){return n||i(),void 0===e&&(e=t.length-1),t[e]},pop:function(){return n||i(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return n||i(),t}}}function i(e,t,n,i,r,a,o){var s=this;s.r1=e,s.r2=t,s.g1=n,s.g2=i,s.b1=r,s.b2=a,s.histo=o}function r(){this.vboxes=new t((function(e,t){return n.naturalOrder(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())}))}function a(t,i){if(i.count()){var r=i.r2-i.r1+1,a=i.g2-i.g1+1,o=i.b2-i.b1+1,s=n.max([r,a,o]);if(1==i.count())return[i.copy()];var d,c,l,u,p=0,m=[],f=[];if(s==r)for(d=i.r1;d<=i.r2;d++){for(u=0,c=i.g1;c<=i.g2;c++)for(l=i.b1;l<=i.b2;l++)u+=t[e(d,c,l)]||0;p+=u,m[d]=p}else if(s==a)for(d=i.g1;d<=i.g2;d++){for(u=0,c=i.r1;c<=i.r2;c++)for(l=i.b1;l<=i.b2;l++)u+=t[e(c,d,l)]||0;p+=u,m[d]=p}else for(d=i.b1;d<=i.b2;d++){for(u=0,c=i.r1;c<=i.r2;c++)for(l=i.g1;l<=i.g2;l++)u+=t[e(c,l,d)]||0;p+=u,m[d]=p}return m.forEach((function(e,t){f[t]=p-e})),b(s==r?"r":s==a?"g":"b")}function b(e){var t,n,r,a,o,s=e+"1",c=e+"2",l=0;for(d=i[s];d<=i[c];d++)if(m[d]>p/2){for(r=i.copy(),a=i.copy(),o=(t=d-i[s])<=(n=i[c]-d)?Math.min(i[c]-1,~~(d+n/2)):Math.max(i[s],~~(d-1-t/2));!m[o];)o++;for(l=f[o];!l&&m[o-1];)l=f[--o];return r[c]=o,a[s]=r[c]+1,[r,a]}}}return i.prototype={volume:function(e){var t=this;return t._volume&&!e||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var n=this,i=n.histo;if(!n._count_set||t){var r,a,o,s=0;for(r=n.r1;r<=n.r2;r++)for(a=n.g1;a<=n.g2;a++)for(o=n.b1;o<=n.b2;o++)s+=i[e(r,a,o)]||0;n._count=s,n._count_set=!0}return n._count},copy:function(){var e=this;return new i(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(t){var n=this,i=n.histo;if(!n._avg||t){var r,a,o,s,d=0,c=0,l=0,u=0;for(a=n.r1;a<=n.r2;a++)for(o=n.g1;o<=n.g2;o++)for(s=n.b1;s<=n.b2;s++)d+=r=i[e(a,o,s)]||0,c+=r*(a+.5)*8,l+=r*(o+.5)*8,u+=r*(s+.5)*8;n._avg=d?[~~(c/d),~~(l/d),~~(u/d)]:[~~(8*(n.r1+n.r2+1)/2),~~(8*(n.g1+n.g2+1)/2),~~(8*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(e){var t=this,n=e[0]>>3;return gval=e[1]>>3,bval=e[2]>>3,n>=t.r1&&n<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},r.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map((function(e){return e.color}))},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,n=0;n<t.size();n++)if(t.peek(n).vbox.contains(e))return t.peek(n).color;return this.nearest(e)},nearest:function(e){for(var t,n,i,r=this.vboxes,a=0;a<r.size();a++)((n=Math.sqrt(Math.pow(e[0]-r.peek(a).color[0],2)+Math.pow(e[1]-r.peek(a).color[1],2)+Math.pow(e[2]-r.peek(a).color[2],2)))<t||void 0===t)&&(t=n,i=r.peek(a).color);return i},forcebw:function(){var e=this.vboxes;e.sort((function(e,t){return n.naturalOrder(n.sum(e.color),n.sum(t.color))}));var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var i=e.length-1,r=e[i].color;r[0]>251&&r[1]>251&&r[2]>251&&(e[i].color=[255,255,255])}},{quantize:function(o,s){if(!o.length||s<2||s>256)return!1;var d=function(t){var n,i,r,a,o=new Array(32768);return t.forEach((function(t){i=t[0]>>3,r=t[1]>>3,a=t[2]>>3,n=e(i,r,a),o[n]=(o[n]||0)+1})),o}(o);d.forEach((function(){0}));var c=function(e,t){var n,r,a,o=1e6,s=0,d=1e6,c=0,l=1e6,u=0;return e.forEach((function(e){n=e[0]>>3,r=e[1]>>3,a=e[2]>>3,n<o?o=n:n>s&&(s=n),r<d?d=r:r>c&&(c=r),a<l?l=a:a>u&&(u=a)})),new i(o,s,d,c,l,u,t)}(o,d),l=new t((function(e,t){return n.naturalOrder(e.count(),t.count())}));function u(e,t){for(var n,i=1,r=0;r<1e3;)if((n=e.pop()).count()){var o=a(d,n),s=o[0],c=o[1];if(!s)return;if(e.push(s),c&&(e.push(c),i++),i>=t)return;if(r++>1e3)return}else e.push(n),r++}l.push(c),u(l,.75*s);for(var p=new t((function(e,t){return n.naturalOrder(e.count()*e.volume(),t.count()*t.volume())}));l.size();)p.push(l.pop());u(p,s-p.size());for(var m=new r;p.size();)m.push(p.pop());return m}}}();e.exports=i.quantize},"f+bf":function(e,t,n){function i(e){return{type:"PIN_BUILDER_REMOVE_PIN_DRAFT_ID",payload:{pinDraftId:e}}}n.d(t,"a",(function(){return i}))},fDVu:function(e,t,n){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return o}));const i=3,r=20,a=100,o=75},g0hQ:function(e,t,n){n.d(t,"a",(function(){return v}));var i=n("s95B"),r=n("26Ai"),a=n("4AHh"),o=n("0ll5"),s=n("fq7B"),d=n("m4CH"),c=n("Kd7H"),l=n("Ye/N"),u=n("7w6Q"),p=n("8nxc"),m=n("HKfR"),f=n("M8j6"),b=n("WPUZ"),h=n("VW7W"),_=n("03SQ"),I=n("9KEC"),g=n("7Cbv"),y=n("wtY2"),O=n("IIK6"),P=n("i+W5"),E=n("D2+t");function v(e,t){return(n,v)=>{const j=v(),{pinItemIds:S,pinItemIndex:D,pinItemShareable:T,status:w,type:A}=j.pinbuilder.pinDrafts[e],R=S.length,N="story"===A,M=N&&p.a.enabled("storyPinExpressive"),k=w;n(Object(P.L)(e,"processing")),n(Object(P.A)(e,null));const U=(t=!1)=>new Promise(i=>{n(t&&M?Object(P.V)(e,!0):Object(P.L)(e,k)),i()}),C=t.map(e=>Object(m.a)(e,{allowVideo:p.a.enabled("video"),forStoryPin:p.a.enabled("storyPinExpressive")}));return Promise.all(C).then(t=>{let m=!1;const v=[],w=[],k=S[0],{pinItems:C,storyPinItemBlocks:x,storyPinItems:L}=j.pinbuilder,{description:B,media:F,title:V}=N?L[k]:C[k],z=M&&L[k].blockIds||[],G=S.length<=1&&(!F&&!M||M&&!z.length),H=S[D],Y=L[H];let W=!1;Y&&(W=M?!!Y.blockIds.find(e=>!!x[e].media):!!Y.media);const q=!N||N&&!W||G;if(N&&!M&&0===D&&q&&"localVideo"===t[0].type){n(Object(P.q)(e,Object(s.b)("STORY_PIN_VIDEO_ON_COVER").message));const i=t.findIndex(e=>"localVideo"!==e.type);if(-1===i)return U();t.splice(0,i)}if(function(e,t,n){return"story"===t?e:"carousel"!==t&&e.length>0&&"localVideo"===e[0].type?e.slice(0,1):e.filter(e=>"localVideo"!==e.type)}(t,A).forEach(e=>{"localImage"===e.type?(w.push(e),u.a.increment("pin_builder.media_upload.image_selected",1,{source:Object(c.a)(j.viewer)})):"localVideo"===e.type?(w.push(e),u.a.increment("pin_builder.media_upload.video_selected",1,{source:Object(c.a)(j.viewer)})):v.push(e)}),N&&v.length&&function(e){e.forEach(e=>{switch(e.id){case"STORY_PIN_VIDEO_OVER_MAX_DURATION":u.a.increment("story_pin.upload.video.over_max_duration",1,{app_type:"web"});break;case"STORY_PIN_VIDEO_OVER_MAX_FILE_SIZE":u.a.increment("story_pin.upload.video.over_max_file_size",1,{app_type:"web"});break;case"VIDEO_UNRECOGNIZED_ENCODING":u.a.increment("story_pin.upload.video.invalid_format",1,{app_type:"web"})}})}(v),!w.length)return v.length>0&&(p.a.enabled("storyPinExpressive")&&v.length>1?n(Object(P.A)(e,l.a._("Uh oh, your files could not be uploaded. Please make sure the files chosen fit within our requirements","pinbuilder.processFiles.invalidFiles","Error message notifying User all of their selected files could not be uploaded"))):n(Object(P.A)(e,v[v.length-1].message))),U();v.length>0&&p.a.enabled("storyPinExpressive")&&n(Object(P.A)(e,l.a._("Uh oh, one or more of your files could not be uploaded","pinbuilder.processFiles.invalidFiles","Error message notifying User some of their selected files could not be uploaded")));const K="carousel"===A||"single"===A&&w.length>1,J=F||w[0],Z=N?O.E:O.D,$=(t,r,o,s)=>{const d=o?Object.assign(t,o.getCanvasOutput({width:s})):t;M&&"localImage"===d.type&&delete d.fileSrc;const c=o?o.toJSON():null,l=N?void 0:C[k].link,u={media:d,canvasJson:c};let p=S[D];if(N)if(0===r&&q){const{media:t}=L[p];m=!!t&&1===w.length,t&&"localVideo"===t.type&&n(Object(f.abortPinDraftItemUpload)(e,p)),n(Object(E.p)(e,p,u)),M&&0===D&&(n(Object(b.a)(e,p,Object(g.a)(),y.n)),n(Object(E.j)(e,p,7)))}else p=Object(g.a)(),n(Object(a.a)(e,p,u,{saveIndex:G})),M&&n(Object(E.j)(e,p,7));else{const t={...T?{description:B,link:l,title:V}:{},...u};if(0===r){const{media:i}=C[p];m=!!i&&1===w.length,i&&"localVideo"===i.type&&n(Object(f.abortPinDraftItemUpload)(e,p)),n(Object(I.p)(p,t))}else p=Object(g.a)(),n(Object(i.a)(e,p,t))}"localVideo"===d.type?n(Object(_.c)(e,p)):"localImage"===d.type&&M&&n(Object(h.d)(e,p))},Q=t=>w.slice(0,q?Z-R+1:Z-R).reduce((e,n,i)=>e.then(()=>"localImage"===n.type&&t?(t.resize(n.width,n.height),t.setImage(n.src).then(()=>{let e=J.width;if(t)if(N)if(M){const t=n.width/n.height;if(t<1)e=Math.min(y.y,n.width);else{e=Math.min(y.y,n.height)*t}}else t.setAspectRatio(Object(o.a)("story")[0]);else{var r,a;const e=G&&w.length>1?Object(d.a)(null!==(r=J.width)&&void 0!==r?r:1,null!==(a=J.height)&&void 0!==a?a:1):{w:J.width,h:J.height};t.setAspectRatio(e)}return $(n,i,t,e)})):$(n,i)),Promise.resolve()).then(()=>{!v.length&&K&&!m&&R+w.length<=O.D&&n(Object(i.a)(e,Object(g.a)(),null,{saveIndex:!0})),n(Object(P.A)(e,v.length?v[v.length-1].message:null)),N||K||!p.a.enabled("imageSignals")||n(Object(P.T)(e))});return K||N?Object(r.a)().then(e=>{const t=new e(document.createElement("div"));return Q(t).then(()=>U(!0))}):Q().then(()=>U(!0))})}}},gCoO:function(e,t,n){n.d(t,"a",(function(){return _}));var i=n("26Ai"),r=n("4AHh"),a=n("Ye/N"),o=n("7w6Q"),s=n("8nxc"),d=n("HKfR"),c=n("WPUZ"),l=n("fDVu"),u=n("7Cbv"),p=n("fq7B"),m=n("Ssxh"),f=n("wtY2"),b=n("i+W5"),h=n("D2+t");function _(e,t,n){return(_,I)=>{const g=I(),{pinDrafts:y,storyPinItemBlocks:O,storyPinItems:P}=g.pinbuilder,{mode:E,pinItemIds:v,pinItemIndex:j,status:S}=y[e],D=v.length,T=v[j],w=0===v.filter(e=>!!P[e].blockIds.length).length,A=w||void 0===P[T].blockIds.find(e=>O[e].media);_(Object(b.L)(e,"processing")),_(Object(b.A)(e,null));const R=t.map(e=>Object(d.a)(e,{allowVideo:s.a.enabled("video"),forStoryPin:!0}));return Promise.all(R).then(t=>{const s=[],d=[];t.forEach(e=>{"localImage"===e.type||"localVideo"===e.type?s.push(e):d.push(e)}),d.length&&function(e){e.forEach(e=>{switch(e.id){case"STORY_PIN_VIDEO_OVER_MAX_DURATION":o.a.increment("story_pin.upload.video.over_max_duration",1,{app_type:"web"});break;case"STORY_PIN_VIDEO_OVER_MAX_FILE_SIZE":o.a.increment("story_pin.upload.video.over_max_file_size",1,{app_type:"web"});break;case"VIDEO_UNRECOGNIZED_ENCODING":o.a.increment("story_pin.upload.video.invalid_format",1,{app_type:"web"})}})}(d);const g=s.slice(0,A?l.b-D+1:l.b-D);if(!g.length)return d.length>1?_(Object(b.A)(e,a.a._("Hmm...there were issues with some of your images or videos. Please make sure the files chosen fit within our requirements","pinbuilder.processFiles.invalidFiles","Error message notifying User all of their selected files could not be uploaded"))):1===d.length?_(Object(b.A)(e,d[0].message)):_(Object(b.A)(e,Object(p.b)("STORY_PIN_TOO_MANY_PAGES").message)),_(Object(b.L)(e,S)),Promise.resolve();d.length&&_(Object(b.A)(e,a.a._("Hmm... there was an issue with an image or video. Try again.","pinbuilder.processFiles.invalidFiles","Error message notifying User some of their selected files could not be uploaded")));const y=(t,i,a,o)=>{const s=a&&o?Object.assign(t,a.getCanvasOutput({width:o})):t;"localImage"===s.type&&delete s.fileSrc;let d=T;0===i&&A?(_(Object(h.p)(e,d,{media:s})),w&&(_(Object(c.a)(e,d,Object(u.a)(),f.n)),_(Object(h.j)(e,d,7)))):(d=Object(u.a)(),_(Object(r.a)(e,d,{media:s},{saveIndex:w})),_(Object(h.j)(e,d,7)));const l=I(),{storyPinItemBlocks:p,storyPinItems:b}=l.pinbuilder;if("localImage"===s.type){const t=b[d].blockIds.find(e=>{var t;return"localImage"===(null===(t=p[e].media)||void 0===t?void 0:t.type)});t&&"edit"!==E&&_(Object(m.b)(e,d,t,s,!0))}else if("localVideo"===s.type){const t=b[d].blockIds.find(e=>{var t;return"localVideo"===(null===(t=p[e].media)||void 0===t?void 0:t.type)});t&&_(Object(m.c)(e,d,t,s,n))}};return Object(i.a)().then(t=>(e=>g.reduce((t,n,i)=>t.then(()=>"localImage"===n.type?(e.resize(n.width,n.height),e.setImage(n.src).then(()=>{const t=n.width/n.height;let r=n.width;return r=t<1?Math.min(f.y,n.width):Math.min(f.y,n.height)*t,y(n,i,e,r)})):y(n,i)),Promise.resolve()))(new t(document.createElement("div"))).then(()=>(_(Object(b.V)(e,!0)),Promise.resolve())))})}}},"i+W5":function(e,t,n){n.d(t,"R",(function(){return U})),n.d(t,"u",(function(){return C})),n.d(t,"L",(function(){return x})),n.d(t,"w",(function(){return B})),n.d(t,"q",(function(){return F})),n.d(t,"I",(function(){return V})),n.d(t,"t",(function(){return z})),n.d(t,"D",(function(){return G})),n.d(t,"E",(function(){return H})),n.d(t,"F",(function(){return Y})),n.d(t,"G",(function(){return W})),n.d(t,"H",(function(){return q})),n.d(t,"y",(function(){return K})),n.d(t,"z",(function(){return J})),n.d(t,"A",(function(){return Z})),n.d(t,"C",(function(){return $})),n.d(t,"M",(function(){return X})),n.d(t,"N",(function(){return ee})),n.d(t,"W",(function(){return te})),n.d(t,"x",(function(){return ne})),n.d(t,"B",(function(){return ie})),n.d(t,"O",(function(){return re})),n.d(t,"n",(function(){return ae})),n.d(t,"l",(function(){return oe})),n.d(t,"S",(function(){return se})),n.d(t,"c",(function(){return de})),n.d(t,"m",(function(){return ce})),n.d(t,"b",(function(){return le})),n.d(t,"j",(function(){return ue})),n.d(t,"d",(function(){return pe})),n.d(t,"e",(function(){return me})),n.d(t,"r",(function(){return fe})),n.d(t,"s",(function(){return be})),n.d(t,"p",(function(){return he})),n.d(t,"k",(function(){return _e})),n.d(t,"U",(function(){return Ie})),n.d(t,"Q",(function(){return ge})),n.d(t,"J",(function(){return ye})),n.d(t,"K",(function(){return Oe})),n.d(t,"a",(function(){return Ee})),n.d(t,"P",(function(){return ve})),n.d(t,"V",(function(){return je})),n.d(t,"h",(function(){return Ne})),n.d(t,"f",(function(){return Ce})),n.d(t,"T",(function(){return xe})),n.d(t,"v",(function(){return Le})),n.d(t,"o",(function(){return Be})),n.d(t,"g",(function(){return Fe})),n.d(t,"i",(function(){return Ve}));var i=n("8mez"),r=n("s95B"),a=n("fq7B"),o=n("Kd7H"),s=n("iru6"),d=n("Ye/N"),c=n("uVIr"),l=n("f+bf"),u=n("eOdZ"),p=n("8nxc"),m=n("2AUE"),f=n("Wrea"),b=n("Joxa"),h=n("KFEb"),_=n("1PPs"),I=n("x12c"),g=n("0wxR"),y=n("U4JR"),O=n("y7BG"),P=n("7Cbv"),E=n("Cdp/"),v=n("M8j6"),j=n("ZQVr"),S=n("JMvu"),D=n("VW7W"),T=n("IIK6"),w=n("9KEC"),A=n("HGZT"),R=n("D2+t"),N=n("03SQ"),M=n("NjDU"),k=n("Wer7");function U(e,t){return{type:"PIN_DRAFT_SET_VIEW",payload:{pinDraftId:e,view:t}}}function C(e,t){return{type:"PIN_DRAFT_SET_CREATE_METHOD",payload:{pinDraftId:e,createMethod:t}}}function x(e,t){return{type:"PIN_DRAFT_SET_STATUS",payload:{pinDraftId:e,status:t}}}function L(e,t){return{type:"PIN_DRAFT_SET_PUBLISHING_STATUS",payload:{pinDraftId:e,publishingStatus:t}}}function B(e,t){return{type:"PIN_DRAFT_SET_IS_AD_INELIGIBLE",payload:{pinDraftId:e,isAdIneligible:t}}}function F(e,t){return{type:"PIN_DRAFT_SET_API_ERROR",payload:{pinDraftId:e,apiError:t}}}function V(e,t){return{type:"PIN_DRAFT_SET_SELECTED_ITEM",payload:{pinDraftId:e,selectedItem:t}}}function z(e,t){return{type:"PIN_DRAFT_SET_BOARD_ERROR",payload:{pinDraftId:e,boardError:t}}}function G(e,t){return{type:"PIN_DRAFT_SET_PUBLISH_OPTION",payload:{pinDraftId:e,publishOption:t}}}function H(e,t){return{type:"PIN_DRAFT_SET_SCHEDULED_DATE",payload:{pinDraftId:e,scheduledDate:t}}}function Y(e,t){return{type:"PIN_DRAFT_SET_SCHEDULED_DATE_ERROR",payload:{pinDraftId:e,scheduledDateError:t}}}function W(e,t){return{type:"PIN_DRAFT_SET_SCHEDULED_TIME",payload:{pinDraftId:e,scheduledTime:t}}}function q(e,t){return{type:"PIN_DRAFT_SET_SCHEDULED_TIME_ERROR",payload:{pinDraftId:e,scheduledTimeError:t}}}function K(e,t){return{type:"PIN_DRAFT_SET_LAST_EDITED_TIME",payload:{pinDraftId:e,lastEditedTime:t}}}function J(e,t){return{type:"PIN_DRAFT_SET_LAST_SAVED_TIME",payload:{pinDraftId:e,lastSavedTime:t}}}function Z(e,t){return{type:"PIN_DRAFT_SET_MEDIA_ERROR",payload:{pinDraftId:e,mediaError:t}}}function $(e,t){return{type:"PIN_DRAFT_SET_PIN_ITEM_INDEX",payload:{pinDraftId:e,pinItemIndex:t}}}function Q(e,t){return{type:"PIN_DRAFT_SET_PIN_ID",payload:{pinDraftId:e,pinId:t}}}function X(e,t){return{type:"PIN_DRAFT_SET_STORY_PIN",payload:{pinDraftId:e,storyPin:t}}}function ee(e,t){return{type:"PIN_DRAFT_SET_STORY_PIN_DRAFT_ID",payload:{pinDraftId:e,storyPinDraftId:t}}}function te(e,t){return{type:"PIN_DRAFT_UPDATE_STORY_PIN_METADATA",payload:{pinDraftId:e,storyPinMetadata:t}}}function ne(e,t){return{type:"PIN_DRAFT_SET_IS_COMMENTS_ALLOWED",payload:{pinDraftId:e,isCommentsAllowed:t}}}function ie(e,t){return{type:"PIN_DRAFT_SET_PIN_ITEM_IDS",payload:{pinDraftId:e,pinItemIds:t}}}function re(e,t){return{type:"PIN_DRAFT_SET_STORY_PIN_SELECTED_PIN_ITEM_IDS",payload:{pinDraftId:e,pinItemIds:t}}}function ae(e){return{type:"PIN_DRAFT_RESET_STORY_PIN_SELECTED_PIN_ITEM_IDS",payload:{pinDraftId:e}}}function oe(e,t){return{type:"PIN_DRAFT_REMOVE_PIN_ITEM",payload:{pinDraftId:e,pinItemId:t}}}function se(e,t,n,i){return{type:"PIN_DRAFT_SET_WEBSITE_LINK",payload:{pinDraftId:e,websiteLink:t,websiteDefaultImageUrl:i,error:n}}}function de(e,t){return{type:"PIN_DRAFT_ADD_WEBSITE_MEDIA",payload:{pinDraftId:e,media:t}}}function ce(e,t){return{type:"PIN_DRAFT_REMOVE_WEBSITE_MEDIA",payload:{pinDraftId:e,mediaUrl:t}}}function le(e,t){return{type:"PIN_DRAFT_ADD_INTEREST_TAG",payload:{pinDraftId:e,tag:t}}}function ue(e,t){return{type:"PIN_DRAFT_REMOVE_INTEREST_TAG",payload:{pinDraftId:e,id:t}}}function pe(e){return{type:"PIN_DRAFT_CLEAR_INTEREST_TAGS",payload:{pinDraftId:e}}}function me(e){return{type:"PIN_DRAFT_CLEAR_WEBSITE_MEDIA",payload:{pinDraftId:e}}}function fe(e,t){return{type:"PIN_DRAFT_SET_ALT_TEXT",payload:{pinDraftId:e,altText:t}}}function be(e,t){return{type:"PIN_DRAFT_SET_ALT_TEXT_ERROR",payload:{pinDraftId:e,altTextError:t}}}function he(e,t="upload"){return(n,a)=>{const{pinbuilder:{pinDrafts:o}}=a(),{pinItemIds:s,pinItemIndex:d,websiteLink:c,websiteMedia:l}=o[e];if(l.length>0){const e=s[d];n(Object(w.l)(e,l[0])),n(Object(w.j)(e,"webImage"===l[0].type&&l[0].sourceURL?l[0].sourceURL:c)),n(Object(w.k)(e,null))}l.length>1&&(p.a.enabled("multi_pin")||p.a.enabled("multi_pin_pinner")?l.slice(1).forEach(e=>{const t=Object(P.a)();n(Object(i.a)(t));const a=Object(P.a)();n(Object(r.a)(t,a,{media:e,link:"webImage"===e.type?e.sourceURL:c}))}):l.slice(1).forEach(t=>n(Object(r.a)(e,Object(P.a)(),{media:t,link:c})))),n(me(e)),n(se(e,"")),n(U(e,t))}}function _e(e,t){return(n,i)=>{const a=i(),{pinDrafts:o,pinItems:s,storyPinItems:d}=a.pinbuilder,{pinItemIds:c,type:l}=o[e],u=c.indexOf(t),p=c.length-1,m="story"===l?R.l:w.l;if(u===p){const{media:i}="story"===l?d[t]:s[t];i&&"webImage"===i.type&&n(Object(w.j)(t,"")),i&&"localVideo"===i.type&&n(Object(v.abortPinDraftItemUpload)(e,t)),n(m(t,null))}else n(oe(e,t)),"carousel"===l&&s[c[p]].media&&n(Object(r.a)(e,Object(P.a)(),null,{saveIndex:!0}))}}function Ie(e,t){return{type:"PIN_DRAFT_UPDATE_DATA",payload:{pinDraftId:e,pinDraft:t}}}function ge(e,t){return{type:"PIN_DRAFT_SET_UPLOAD_START_TIME",payload:{pinDraftId:e,uploadStartTime:t}}}function ye(e,t){return(n,i)=>{const r=i(),{pinItemIds:a,pinItemIndex:o}=r.pinbuilder.pinDrafts[e];if(n(function(e,t){return{type:"PIN_DRAFT_SET_PIN_ITEM_SHAREABLE",payload:{pinDraftId:e,pinItemShareable:t}}}(e,t)),t){const e=a[o],{description:t,descriptionError:i,link:s,linkError:d,title:c,titleError:l}=r.pinbuilder.pinItems[e];a.forEach(e=>n(Object(w.p)(e,{description:t,descriptionError:i,link:s,linkError:d,title:c,titleError:l})))}}}function Oe(e,t){return(n,i)=>{const r=i(),{pinItemIds:a,pinItemIndex:o,pinItemShareable:s}=r.pinbuilder.pinDrafts[e];(s?a:[a[o]]).forEach(e=>n(Object(w.p)(e,t)))}}function Pe(e,t){const n=t?Object(s.a)(e,t):null;if(e.customCoverImg){if(n){const{origin_x:t=0,origin_y:i=0,width:r=e.width,height:a=e.height}=n;return Object(S.a)(e.customCoverImg.src,{x:t,y:i,width:r,height:a})}return Promise.resolve(e.customCoverImg.src)}if(n){const{origin_x:t=0,origin_y:i=0,width:r=e.width,height:a=e.height}=n,{trimmedStartTime:o,trimmedEndTime:s,duration:d,thumbnail:c}=e,l=o||0,u=s||d,p=c>=l&&c<=u?c:l;return Object(S.b)(e,p,{x:t,y:i,width:r,height:a})}return Object(S.b)(e,e.thumbnail)}function Ee(e,t,n=2){return(i,r)=>{const a=r(),{pinbuilder:o}=a,{pinDrafts:s}=o,{interestTags:d}=s[e],c=d.map(e=>e.id);if(c.length>0){const e={pinId:t,interestIds:c,zenSource:n};u.a.create("InterestTaggingResource",e).callCreate().catch(()=>{throw new Error("Cannot add tags to the Pin.")})}}}function ve(e,t){return{type:"PIN_DRAFT_SET_STORY_PIN_UPLOAD_MANAGER",payload:{pinDraftId:e,uploadManager:t}}}function je(e,t){return(n,i)=>{const r=i(),{pinDrafts:a}=r.pinbuilder;n(K(e,new Date)),!t&&T.S.includes(a[e].status)||n(x(e,"edited"))}}function Se(e){return new Promise((t,n)=>{Promise.all(e.map(e=>(e.linkBlock&&e.linkBlock.imageUrl&&Object(O.e)(e).then(t=>Promise.resolve({...e,linkBlock:t})),Promise.resolve({...e})))).then(e=>{t({metadata:{},pages:e.map(A.d)})}).catch(e=>{n(e)})})}function De(e,t,n,i,r){return{metadata:{pin_title:i,pin_image_signature:e[0].coverImgSignature,basics:null!=r&&r.basics?Object(b.c)(r.basics):void 0,diy_data:null==r?void 0:r.diyData,recipe_data:null==r?void 0:r.recipeData,template_type:null==r?void 0:r.templateType},pages:e.map((e,n)=>Object(A.c)(e,e.blockIds.map(e=>t[e]),n))}}function Te({pinDraftId:e,state:t,dispatch:n,orbacSubjectId:i}){return new Promise((r,a)=>{const{advertiser:s,pinbuilder:c,viewer:l}=t,{fonts:u,pinDrafts:m,pinItems:f,storyPinItemBlocks:b,storyPinItems:h}=c,{altText:I,pinItemIds:g,pinItemIndex:y,selectedItem:O,storyPinMetadata:P,type:E}=m[e];if(!O)throw new Error(d.a._("Cannot create a Pin without a board.","pinBuilder.error.noBoard","Error message about user trying to create a Pin without a board"));const v=l.isAuth&&s&&s.owner_user_id!==l.id?s.id:null,S={board_id:O.boardId,field_set_key:"create_success",skip_pin_create_log:!0,...I?{alt_text:I}:Object.freeze({}),...O.sectionId?{section:O.sectionId}:Object.freeze({}),...v?{advertiser_id:v}:Object.freeze({}),...i?{orbac_subject_id:i}:Object.freeze({})};if("carousel"===E)Object(j.h)(g.map(e=>f[e]),e,p.a.enabled("useVIP")).then(e=>{r({...S,...e.metadata,carousel_data_json:{carousel_slots:e.slots}})}).catch(e=>{a(e)});else if("story"===E)if(p.a.enabled("storyPinExpressive")){const n=De(g.map(e=>h[e]).filter(e=>!!e.blockIds.length),b,0,Object(_.h)(t,{pinDraftId:e}),P);r({...S,story_pin:JSON.stringify(n)})}else{Se(g.map(e=>h[e]).filter(e=>!!e.media)).then(e=>{r({...S,story_pin:JSON.stringify(e)})}).catch(e=>{a(e)})}else if("single"===E){const t=g[y],{description:i,link:s,media:c,canvasJson:u,title:b,userMentionTags:h}=f[t];if(!c)throw new Error(d.a._("Cannot create a Pin without an image or video.","pinBuilder.error.noMedia","Error message about user trying to create a Pin without an image or video"));const _=b.substring(0,T.lb),I=i.substring(0,T.f);if("localImage"===c.type)p.a.enabled("useVIP")?Object(j.g)(c.src,e).then(({signature:e})=>{e?r({...S,description:I,link:s,title:_,image_url:Object(j.b)(e),method:"uploaded",upload_metric:{source:Object(o.a)(l)},user_mention_tags:h}):a()}).catch(()=>{const t=d.a._("Hmm, your upload failed for some reason. Please try again.","pinBuilder.mediaUpload.error","Error message uploading a video file and process fails");n(Z(e,t)),a(new Error(d.a._("Cannot create Pin because the image could not be uploaded.","pinBuilder.error.noImageUploaded","Error message about user trying to create a Pin without an image uploaded")))}):Object(j.i)(c.src).then(({image_url:e})=>{r({...S,description:I,link:s,title:_,image_url:e,method:"uploaded",upload_metric:{source:Object(o.a)(l)},user_mention_tags:h})}).catch(e=>{a(e)});else if("webImage"===c.type){const{createMethod:t}=m[e];r({...S,description:I,link:s,title:_,image_url:c.src,method:t||"scraped",scrape_metric:{source:"www_url_scrape"},user_mention_tags:h})}else{if("localVideo"!==c.type)throw new Error(d.a._("Cannot create Pin because the media type is not recognized.","pinBuilder.error.noMediaRecognized","Error message about user trying to create a Pin without a recognized media type"));Pe(c,u).then(t=>p.a.enabled("useVIP")?Object(j.g)(t,e).then(({signature:e})=>{if(e)return{image_url:Object(j.b)(e)};throw new Error}):Object(j.i)(t)).then(({image_url:e})=>r({...S,description:I,link:s,title:_,image_url:e,media_upload_id:c.uploadId,user_mention_tags:h})).catch(()=>{const t=d.a._("Hmm, your upload failed for some reason. Please try again.","Error message uploading a video file and process fails","Error message uploading a video file and process fails");n(Z(e,t)),a(new Error(d.a._("Cannot create Pin because the video could not be uploaded.","pinBuilder.error.noVideoUploaded","Error message about user trying to create a Pin without an video uploaded")))})}}})}function we(e,t,n){return new Promise((n,i)=>{const{pinbuilder:{pinDrafts:r,pinItems:a}}=t,{pinItemIds:o,pinItemIndex:s}=r[e],d=o[s],{media:c}=a[d];if(!c)throw new Error("Invalid media");const l=p.a.enabled("useVIP");if("localImage"===c.type)Object(j.j)(c.src,e,l).then(e=>n({image_signature:e})).catch(()=>{i(new Error("Cannot schedule the Pin."))});else{if("localVideo"!==c.type)throw new Error("Cannot upload this media type.");{const t=c.uploadId;Pe(c).then(t=>Object(j.j)(t,e,l)).then(e=>n({image_signature:e,media_upload_id:t})).catch(()=>{i(new Error("Cannot schedule the Pin"))})}}})}function Ae(e,t){return(n,i)=>{const r=i();if(t&&(t.message||t.message_detail)){const i=t.message_detail||t.message,{pinItemIds:o,pinItemIndex:s}=r.pinbuilder.pinDrafts[e],d=o[s],c=[];switch(t.api_error_code){case 9:switch((t.data||{}).source_field){case"description":c.push({...Object(a.b)("DESCRIPTION_INVALID",d),message:i});break;case"title":c.push({...Object(a.b)("TITLE_INVALID",d),message:i});break;default:c.push({...Object(a.b)("URL_INVALID",d),message:i})}break;case 2378:c.push({...Object(a.b)("CAROUSEL_DIFFERENT_RATIOS",e),dispatchId:e,message:i});break;default:n(F(e,i))}c.length>0&&n(Object(E.b)(c,e))}}}function Re(e,t,n){return(i,r)=>{const{viewer:a,pinbuilder:{pinDrafts:o}}=r();i(function(e,t){return(n,i)=>{const r=i(),{pinbuilder:{pinDrafts:a,pinDraftIds:o,pinItems:s,storyPinItems:d}}=r,{pinItemIds:c,type:l,interestTags:u}=a[e],f=c[0],b="story"===l,{title:h,description:_,media:I}=b?d[f]:s[f],g=b?[]:s[f].userMentionTags,y=b?d[f].linkBlock&&d[f].linkBlock.srcUrl:s[f].link,O=I&&"localVideo"===I.type?"video":"image",P="single"===l?O:l,E=!!h,v=!!_,j=!!y,{canvasJsons:S,signals:D}=c.reduce((e,t)=>{const n=b?d[t]:s[t],{canvasJson:i,signals:r}=n,a=Object.keys(r).map(e=>({signal:e,value:r[e]}));return{canvasJsons:[...e.canvasJsons,i],signals:[...e.signals,...a]}},{canvasJsons:[],signals:[]}),T={signals:D,is_multi_pin_create:o.length>1,num_images:!!S&&Math.max(...S.map(e=>e&&e.layout?e.layout.sections.length:1))||1,text:S.reduce((e,t)=>(t&&t.text&&e.push({font_family:t.text.fontFamily,position:t.text.position,font_size:t.text.fontSize,margin:t.text.margin,bg_color:t.text.backgroundColor,bg_opacity:t.text.backgroundOpacity,text_color:t.text.textColor}),e),[]),logo:S.reduce((e,t)=>(t&&t.logo&&e.push({position:t.logo.position,margin:t.logo.margin,size:t.logo.size,bg_color:t.logo.backgroundColor,bg_opacity:t.logo.backgroundOpacity}),e),[])};I&&"localVideo"===I.type&&p.a.enabled("videoTagging")&&(T.interest_tags=u.length);const w={pin_draft_id:e,has_description:v,has_link:j,has_title:E,is_video:"video"===P,media_upload_id:I&&"localVideo"===I.type?I.uploadId:void 0,pin_builder_data:JSON.stringify(T),pin_format:P,num_user_mention_tags:g.length,signals:JSON.stringify(D),..."image"===P||"carousel"===P||"video"===P&&p.a.enabled("videoEditing")?{has_logo:S.some(e=>!!e&&!!e.logo),has_text:S.some(e=>!!e&&!!e.text),is_cropped:S.some(e=>{if(!e||!e.layout)return!1;const t=e.layout.sections.map(e=>e.media);return t.length>1||1===t.length&&!!t[0]&&(0!==t[0].angle||t[0].flipX||t[0].flipY||t[0].viewbox&&(1!==t[0].viewbox.width||1!==t[0].viewbox.height))}),is_trimmed:I&&"localVideo"===I.type?!!I.trimmedStartTime&&!!I.trimmedEndTime&&!!I.duration&&(I.trimmedStartTime>0||I.duration-I.trimmedEndTime>.01):void 0}:Object.freeze({}),pin_builder_scenario:p.a.scenario()};if(Object(m.a)(1,{objectId:t,...w}),I&&"localVideo"===I.type)if(I.customCoverImg)Object(m.a)(7896,{objectId:t});else{const e=(100*I.thumbnail/I.duration).toFixed(2);Object(m.a)(7517,{objectId:t,percentage_scrubbed:e})}}}(e,t.id));const{pinItemIds:s,pinItemIndex:d,selectedItem:l}=o[e],u=s[d],b=t.board&&t.board.id||l&&l.boardId;return i(Object(w.f)(u,t.id,n&&n.advertiser_id)).then(()=>{i(Q(e,t.id)),i(Object(f.d)({boardId:b,sectionId:t.section?t.section.id:null,increment:1})),i(Object(c.a)({feedId:t.section?t.section.id:b,feedType:t.section?h.a.SECTION_PINS:h.a.BOARD_PINS,itemIds:[t.id],itemType:"pin"})),i(Object(M.c)({userId:a.isAuth?a.id:"",increment:1})),I.b.publish("currentUser","pinCreated",t),I.b.publish(b,"pinCreated",{pin:t})})}}function Ne(e,t){return(n,i)=>{const r=i(),{pinDrafts:a}=r.pinbuilder,{selectedItem:o}=a[e],{board:s}=t,d=s&&s.id||o&&o.boardId;n(Q(e,t.id)),n(Object(f.d)({boardId:d,sectionId:t.section?t.section.id:null,increment:1})),n(Object(c.a)({feedId:t.section?t.section.id:d,feedType:t.section?h.a.SECTION_PINS:h.a.BOARD_PINS,itemIds:[t.id],itemType:"pin"})),n(Object(M.c)({userId:r.viewer.isAuth?r.viewer.id:"",increment:1})),I.b.publish("currentUser","pinCreated",t),I.b.publish(d,"pinCreated",{pin:t})}}function Me(e){return(t,n)=>{const i=n(),{pinbuilder:{pinDraftIdUploadStatusMap:r}}=i;return!(!r||!r[e]||"uploading"!==r[e].status)}}function ke(e){const t=(n=0)=>u.a.create("StoryPinResource",e).callCreate().catch(e=>n<T.H?new Promise(e=>setTimeout(e,T.gb)).then(()=>t(n+1)):Promise.reject(e));return new Promise((e,n)=>{t().then(t=>e(t)).catch(e=>n(e))})}function Ue(e,t){return(n,i)=>{const r=i(),{pinDrafts:a,storyPinItemBlocks:o,storyPinItems:s}=r.pinbuilder,d=a[e],{pinItemIds:c}=d,l=p.a.enabled("storyPinExpressive"),u=l?c.reduce((e,t)=>[...e,...s[t].blockIds.map(e=>o[e])],[]):[],m=u.filter(e=>{var t;return["localImage","webImage"].includes(null===(t=e.media)||void 0===t?void 0:t.type)}).length,f=u.filter(e=>{var t;return["localVideo","webVideo"].includes(null===(t=e.media)||void 0===t?void 0:t.type)}).length;return null==t||t.addBinaryAnnotation("image.count",m,"I16"),null==t||t.addBinaryAnnotation("video.count",f,"I16"),null==t||t.addBinaryAnnotation("page.count",a[e].pinItemIds.length,"I16"),n(x(e,"publishing")),Object(y.b)(8787,{eventData:{storyPinData:{isExpressive:l,numImages:m,numVideos:f,numPages:a[e].pinItemIds.length}},story_pin_upload_id:e}),a[e].uploadStartTime||n(ge(e,new Date)),n(Object(E.a)(e,"save")).then(()=>(n(F(e,null)),n(function(e){return(t,n)=>{const i=n(),{pinDraftIdUploadStatusMap:r,storyPinItemBlocks:a,storyPinItems:o}=i.pinbuilder;if(r[e]){const n=Object.keys(r[e].items).filter(t=>"queueEdit"===r[e].items[t].status);if(n.length>0)return n.forEach(n=>{const i=o[n].blockIds.find(e=>{var t;return"localVideo"===(null===(t=a[e].media)||void 0===t?void 0:t.type)});i&&a[i].media&&a[i].media.signature&&t(Object(N.b)(e,n))}),!0}return!1}}(e))||n(Me(e))?(n(Object(v.setPinBuilderPinDraftUploadStatus)(e,"queueCreate")),null):n(Object(D.c)(e)).then(()=>n(Object(D.b)(e))).then(()=>n(Object(E.a)(e,"publishStoryPin"))).then(()=>{const t=i();return Te({pinDraftId:e,state:t,dispatch:n})}).then(e=>Promise.all([ke(e),e])).then(([t,r])=>{const a=i(),{pinDrafts:o}=a.pinbuilder,{data:s}=t.resource_response,c=o[e].uploadStartTime,l=c?new Date-c:-1;n(Object(k.b)("StoryPinResource",r,s)),n(X(e,s)),n(Ne(e,s)),o[e].interestTags.length&&n(Ee(e,s.id,3)),n(function({imageSig:e,numImages:t,numPages:n,numVideos:i,pinDraftId:r,pinId:a,storyPinDataId:o,uploadTime:s}){return d=>{Object(y.b)(7590,{eventData:{storyPinData:{numImages:t,numPages:n,numVideos:i,isExpressive:p.a.enabled("storyPinExpressive"),storyPinDataIdStr:o}},objectId:a,image_signature:e,story_pin_upload_id:r,upload_time:s})}}({numImages:m,numVideos:f,pinDraftId:e,imageSig:s.imageSignature,numPages:o[e].pinItemIds.length,pinId:s.id,storyPinDataId:s.story_pin_data_id,uploadTime:l})),d.storyPinDraftId?n(Object(D.a)(d.storyPinDraftId)).finally(()=>n(x(e,"succeeded"))):n(x(e,"succeeded"))}))).catch(t=>{const r=i(),{pinDrafts:a}=r.pinbuilder,o=a[e].uploadStartTime,s=o?new Date-o:-1;n(Ae(e,t)),Object(y.b)(7726,{eventData:{storyPinData:{isExpressive:l,numImages:m,numVideos:f,numPages:a[e].pinItemIds.length}},story_pin_create_failure_message:!!t&&(t.message_detail||t.message),story_pin_upload_id:e,upload_time:s}),n(x(e,"attempted")),n(ge(e,null))})}}function Ce({pinDraftId:e,storyPinPublishStopwatch:t,orbacSubjectId:n}){return(i,r)=>{const{pinbuilder:{pinDrafts:a}}=r(),{scheduledDate:o,scheduledTime:s,type:d}=a[e];i(o&&s?function(e){return(t,n)=>{const i=n(),{viewer:r,pinbuilder:{pinDrafts:a,pinItems:o}}=i;t(x(e,"publishing"));const{pinItemIds:s,pinItemIndex:d,scheduledDate:c,scheduledTime:m,selectedItem:f}=a[e],b=s[d],{description:h,link:_,media:I,title:y}=o[b];return t(Object(E.a)(e,"save")).then(()=>{if(t(Me(e)))return p.a.enabled("multi_pin")||p.a.enabled("multi_pin_pinner")?(t(Object(v.setPinBuilderPinDraftUploadStatus)(e,"queueCreate")),t(x(e,"uploading"))):t(Object(l.a)(e)),null;if(!c||!m)throw new Error("Cannot schedule a Pin without a scheduled date or time.");const n=new Date(c.getFullYear(),c.getMonth(),c.getDate(),m.getHours(),m.getMinutes(),m.getSeconds()).getTime()/1e3;return Promise.all([we(e,i),n]).then(([e,t])=>{if(!f)throw new Error("Cannot schedule a Pin without a board.");const n=y.substring(0,T.lb),i=h.substring(0,T.f),{image_signature:r,media_upload_id:a}=e,o={description:i,image_signature:r,link:_,media_upload_id:a,title:n,board:f.boardId,scheduled_timestamp:t,...f.sectionId?{section:f.sectionId}:{}};return u.a.create("ScheduledPinResource",o).callCreate()}).then(n=>{if(!I)throw new Error("Cannot schedule a Pin without an image.");const{data:i}=n.resource_response,a={...i,localMedia:I.src};t(function(e,t){return{type:"PIN_DRAFT_SET_SCHEDULED_PIN",payload:{pinDraftId:e,scheduledPin:t}}}(e,a)),t(Object(g.c)(i)),t(Object(M.d)({userId:r.isAuth?r.id:"",increment:1})),t(x(e,"succeeded"))})}).catch(()=>{throw t(x(e,"attempted")),new Error("Cannot schedule the Pin.")})}}(e):"story"===d?Ue(e,t):function({pinDraftId:e,orbacSubjectId:t}){return(n,i)=>{const r=i(),{pinbuilder:a}=r,{pinDrafts:o}=a,{status:s}=o[e];return"uploading"!==s&&n(x(e,"publishing")),n(Object(E.a)(e,"save")).then(()=>(n(L(e,"publishing")),n(Me(e))?(n(Object(v.setPinBuilderPinDraftUploadStatus)(e,"queueCreate")),p.a.enabled("multi_pin")||p.a.enabled("multi_pin_pinner")?n(x(e,"uploading")):n(Object(l.a)(e)),null):Te({pinDraftId:e,state:r,dispatch:n,orbacSubjectId:t}).then(e=>Promise.all([u.a.create("PinResource",e).callCreate(),e])).then(([t,i])=>{const{data:r}=t.resource_response;n(Object(k.b)("PinResource",i,r)),p.a.enabled("videoTagging")&&n(Ee(e,r.id)),n(Re(e,r,i)).then(()=>{n(x(e,"succeeded")),n(L(e,"succeeded")),n(Object(v.addCreatedPinId)(r.id))})}).catch(t=>{n(Ae(e,t)),n(x(e,"attempted")),n(L(e,"serverError"))}))).catch(()=>{n(x(e,"created")),n(L(e,"clientError"))})}}({pinDraftId:e,orbacSubjectId:n}))}}function xe(e){return(t,n)=>{const i=n(),{pinbuilder:r}=i,{pinDrafts:a,pinItems:o,storyPinItems:s}=r,{pinItemIds:d,pinItemIndex:c,type:l}=a[e];if("single"===l||"story"===l){const n=d[c],{media:i}="story"===l?s[n]:o[n];if(i&&!i.signature){const{src:r}=i;Object(j.k)(r,"pinimage").then(({signature:i})=>{t(Object(w.q)(n,{signature:i})),t(Object(E.a)(e,"signal",{fieldToCheck:"image_signature"})).catch(()=>{})})}}}}function Le(e,t,n,i,r){return(a,o)=>{const s=o(),{pinItemIds:d,type:c}=s.pinbuilder.pinDrafts[e];d.forEach(e=>{const{canvasJson:o,media:s}=n[e]||{},d=t===e?i:s,l=t===e?r:o,u="story"===c?R.i:w.h;l&&d&&a(u(e,d,l))});const{media:l}=n[t],u="single"===c&&l&&"localVideo"===l.type?N.a:xe;a(u(e))}}function Be({pinDraftId:e,storyPinPublishStopwatch:t,orbacSubjectId:n}){return(i,r)=>{const{pinbuilder:{pinDrafts:a,pinDraftIds:o,pinItems:s,storyPinItems:d}}=r(),{mode:c,pinItemIds:l,pinItemIndex:u,type:p}=a[e],m=l[u],{media:f}="story"===p?d[m]:s[m];if("create"===c){if(f&&"localVideo"===f.type&&0===o.length)return i(Object(N.c)(e,m)),void i(Object(v.setPinBuilderPinDraftUploadStatus)(e,"queueCreate"));i(Ce({pinDraftId:e,storyPinPublishStopwatch:t,orbacSubjectId:n}))}else"edit"===c&&i(function(e){return(t,n)=>{const{pinbuilder:{pinDrafts:i}}=n(),{pinItemIds:r,pinItemIndex:a}=i[e],o=r[a];t(Object(w.e)(o,e))}}(e))}}function Fe(e){return(t,n)=>{const{pinbuilder:{pinDrafts:i}}=n(),{pinItemIds:a,pinItemIndex:o,websiteLink:s,websiteMedia:d,selectedItem:c,createMethod:l}=i[e],u="webImage"===d[0].type&&d[0].sourceURL?d[0].sourceURL:s,p=a[o];t(Object(w.l)(p,d[0])),t(Object(w.j)(p,u)),t(Ce({pinDraftId:e})),d.slice(1).forEach(e=>{const n=Object(P.a)(),i=Object(P.a)();t(Object(r.a)(n,i,{media:e,link:u})),t(V(n,c)),l&&t(C(n,l)),t(Ce({pinDraftId:n}))})}}function Ve(e){return(t,n)=>{const i=n(),{pinbuilder:{pinDrafts:r}}=i;for(const[a,o]of Object.entries(r))if(o.pinId===e)return void t(Object(l.a)(a))}}},iru6:function(e,t,n){n.d(t,"a",(function(){return r}));var i=n("RjJ5");function r(e,t){const{layout:n}=t||{},{sections:r}=n||{},a=r&&1===r.length?r[0]:{},{media:o}=a||{},{viewbox:s,angle:d,width:c,height:l}=o||{};let u={},p=!1;if(s){const t=Math.round(s.width*c),n=Math.round(s.height*l),r=Math.round(s.left*c-t/2),a=Math.round(s.top*l-n/2),o=d||0;u={origin_x:r,origin_y:a,width:t,height:n,rotation:o},p=r>Number.EPSILON||a>Number.EPSILON||1-s.width>Number.EPSILON||1-s.height>Number.EPSILON||0!==o;const m=e.duration?e.duration:0,f=e.trimmedStartTime?e.trimmedStartTime:0,b=e.trimmedEndTime?e.trimmedEndTime:m;return u={...u,time_start:Object(i.c)(f),time_end:Object(i.c)(b)},p=p||f>Number.EPSILON||m-b>.01,p?u:null}return null}},l46A:function(e,t,n){n.d(t,"a",(function(){return P})),n.d(t,"b",(function(){return E})),n.d(t,"f",(function(){return v})),n.d(t,"e",(function(){return L})),n.d(t,"d",(function(){return B})),n.d(t,"c",(function(){return F}));var i=n("VBRM"),r=n("TYy9"),a=n.n(r),o=n("eOdZ"),s=n("8nxc"),d=n("aK+E"),c=n("HxmZ"),l=n("Wer7"),u=n("9KEC"),p=n("7Cbv"),m=n("fq7B"),f=n("1PPs"),b=n("IIK6"),h=n("c50B");function _(e,t){const{pinItemIds:n,pinItemIndex:i}=e.pinbuilder.pinDrafts[t];return n[i]}function I(e,t){const{pinbuilder:{pinItems:n}}=e;return n[_(e,t)]}function g(e){if(e){const t=Object.keys(e),n=[];return t.forEach(t=>{const i=Object.keys(e[t]);i.length>0&&i.forEach(e=>{switch(parseInt(e,10)){case 1:n.push(Object(m.b)("URL_UNREACHABLE",t));break;case 2:n.push(Object(m.b)("URL_CONTAINS_PORN_DOMAIN",t));break;case 304:n.push(Object(m.b)("IMAGE_DOES_NOT_HAVE_RECOMMENDED_RATIO",t));break;case 301:n.push(Object(m.b)("IMAGE_UNDER_MIN_DIMENSIONS",t));break;case 9:n.push(Object(m.b)("LINK_LOADS_SLOWLY",t));break;case 10:n.push(Object(m.b)("LINK_IS_AGGREGATOR",t));break;case 305:n.push(Object(m.b)("IMAGE_IS_SCREENSHOT",t));break;case 306:n.push(Object(m.b)("IMAGE_IS_BLURRY",t))}})}),n}return[]}function y(e,t){return(n,i)=>{const r=i(),{pinItems:a}=r.pinbuilder,o={},{signals:s}=a[e];switch(t){case"link_url":Object.prototype.hasOwnProperty.call(s,"URL_CONTAINS_PORN_DOMAIN")&&(o.URL_CONTAINS_PORN_DOMAIN=!1),Object.prototype.hasOwnProperty.call(s,"URL_UNREACHABLE")&&(o.URL_UNREACHABLE=!1);break;case"image_signature":Object.prototype.hasOwnProperty.call(s,"IMAGE_DOES_NOT_HAVE_RECOMMENDED_RATIO")&&(o.IMAGE_DOES_NOT_HAVE_RECOMMENDED_RATIO=!1),Object.prototype.hasOwnProperty.call(s,"IMAGE_UNDER_MIN_DIMENSIONS")&&(o.IMAGE_UNDER_MIN_DIMENSIONS=!1)}Object.keys(o).length>0&&n(Object(u.p)(e,{signals:o}))}}function O(e){return(t,n)=>{const i=n();return new Promise(t=>{const{selectedItem:n}=i.pinbuilder.pinDrafts[e];t(n?null:Object(m.b)("BOARD_MISSING",e))})}}function P(e,t=Object(p.a)(),n,i){return new Promise(r=>{if(e)if(Object(h.s)([Object(h.r)({message:Object(m.b)("URL_INVALID").message})],e).length>0)r([Object(m.b)("URL_INVALID",t)]);else if(s.a.enabled("linkStatusValidation")){const a="PinCreationQualitySignalResource",s={pin_items:{[t]:{link_url:e}}};if(n&&n.data[a]&&n.data[a][e]){const i={[t]:n.data[a][e]};r(g(i))}else o.a.create(a,s).callGet().then(t=>{const{data:o}=t.resource_response;!function(e,t,n){if(t){const i=n[Object.keys(n)[0]];e&&e.data&&(e.data.PinCreationQualitySignalResource||(e.data.PinCreationQualitySignalResource={}),e.data.PinCreationQualitySignalResource[t]=i)}}(n,e,o),i&&i(Object(l.b)(a,s,o)),r(g(o))}).catch(e=>r(null))}else r(null);else s.a.enabled("requireLink")?r([Object(m.b)("URL_MISSING",t)]):r(null)})}function E(e){return(t,n)=>{const i=n(),{pinbuilder:r,resources:a}=i,{pinDrafts:o,pinItems:s,storyPinItems:d}=r,{pinItemIds:c,type:l}=o[e];return c.filter(e=>"carousel"!==l||!!s[e].media).map(e=>("story"!==l&&t(y(e,"link_url")),P("story"===l?d[e].linkBlock&&d[e].linkBlock.srcUrl:s[e].link,e,a,t)))}}function v(e,t){return(n,i)=>{const r=i(),{pinbuilder:a,resources:s}=r,{pinDrafts:c,pinItems:u,storyPinItems:p}=a,{pinItemIds:m,type:f}=c[e],b="PinCreationQualitySignalResource";if("story"===f)return Promise.resolve([]);const h={pin_items:m.reduce((e,n)=>{const i="story"===f,{title:r,description:a,media:o}=i?p[n]:u[n],s=i?p[n].linkBlock.srcUrl:u[n].link;return{...e,[n]:{title:r,description:a,image_signature:o&&"localImage"===o.type?o.signature:"",link_url:s,fields_to_check:[t]}}},{})},_=Object(d.a)(h);if(s&&s.data[b]&&s.data[b][_]){const{data:e}=s.data[b][_];return m.map(e=>n(y(e,t))),Promise.resolve(g(e))}return new Promise(e=>{o.a.create(b,h).callGet().then(i=>{const{data:r}=i.resource_response;return m.map(e=>n(y(e,t))),n(Object(l.b)(b,h,r)),e(g(r))}).catch(t=>e([]))})}}function j(e){return(t,n)=>{const i=n();return new Promise(t=>{Object(f.g)(i,{pinDraftId:e}).filter(e=>null!==e.media).length<b.hb?t(Object(m.b)("STORY_PIN_NOT_ENOUGH_PAGES",e)):t(null)})}}function S(e){return(t,n)=>{const i=n();return new Promise(t=>{const n=Object(f.g)(i,{pinDraftId:e}).filter(e=>!!e.blockIds.length);0===n.length?t(Object(m.b)("STORY_PIN_NOT_ENOUGH_PAGES")):n.length>b.E?t(Object(m.b)("STORY_PIN_TOO_MANY_PAGES")):t(null)})}}function D(e){return(t,n)=>{const i=n();return new Promise(t=>{const n=Object(f.b)(i,{pinDraftId:e});return 1!==Object(c.c)(i,{pinItemId:n[0]}).filter(e=>("story_pin_image_block"===e.type||"story_pin_video_block"===e.type)&&!!e.media).length?t(Object(m.b)("STORY_PIN_COVER_PAGE_IMAGE_MISSING")):t(null)})}}function T(e){return(t,n)=>{const i=n();return new Promise(t=>t(Object(f.h)(i,{pinDraftId:e})?null:Object(m.b)("STORY_PIN_TITLE_MISSING")))}}const w=[O,E,function(e){return(t,n)=>{const i=n();return new Promise(t=>{const{type:n}=i.pinbuilder.pinDrafts[e],{media:r}=I(i,e);t("carousel"===n||r?null:Object(m.b)("MEDIA_MISSING",e))})}},function(e){return(t,n)=>{const i=n();return new Promise(t=>{const{isTaggable:n,pinTagIds:r}=I(i,e),a=r.filter(e=>"deleted"!==i.pinbuilder.pinTags[e].status);t(!n&&a.length>0?Object(m.b)("TAG_INVALID",_(i,e)):null)})}},function(e){return(t,n)=>{const r=n();return new Promise(t=>{const{publishOption:n,scheduledDate:a}=r.pinbuilder.pinDrafts[e],o=new Date;o.setHours(0,0,0,0),"publish-immediately"!==n&&(a?a<o?t(Object(m.b)("DATE_IN_PAST",e)):a>Object(i.a)(new Date,b.I)&&t(Object(m.b)("DATE_TOO_FAR_IN_FUTURE",e)):t(Object(m.b)("DATE_MISSING",e))),t(null)})}},function(e){return(t,n)=>{const i=n();return new Promise(t=>{const{publishOption:n,scheduledTime:r}=i.pinbuilder.pinDrafts[e];t("publish-immediately"===n||r?null:Object(m.b)("TIME_MISSING",e))})}}],A=[O,E,function(e){return(t,n)=>{const i=n();return new Promise(t=>{const{pinItemIds:n}=i.pinbuilder.pinDrafts[e],{canvasJson:r}=i.pinbuilder.storyPinItems[n[0]];r&&r.aspectRatio&&9===r.aspectRatio.w&&16===r.aspectRatio.h?t(null):t(Object(m.b)("STORY_PIN_COVER_PAGE_INVALID_ASPECT_RATIO",e))})}},function(e){return(t,n)=>{const i=n();return new Promise(t=>{const{pinItemIds:n}=i.pinbuilder.pinDrafts[e],{media:r}=i.pinbuilder.storyPinItems[n[0]];r&&"localVideo"===r.type?t(Object(m.b)("STORY_PIN_VIDEO_ON_COVER",e)):t(null)})}},function(e){return(t,n)=>{const i=n();return new Promise(t=>{const{pinItemIds:n}=i.pinbuilder.pinDrafts[e],{title:r}=i.pinbuilder.storyPinItems[n[0]];t(r?null:Object(m.b)("STORY_PIN_COVER_PAGE_TITLE_MISSING",e))})}},j],R=[O,D,S,T],N=(e,t)=>{const{pinItemIds:n}=e.pinbuilder.pinDrafts[t];return(n.length?e.pinbuilder.storyPinItems[n[0]]:{}).blockIds.length?R:A},M=[O,E,j],k=[O,D,S,T],U=(e,t)=>{const{pinItemIds:n}=e.pinbuilder.pinDrafts[t];return(n.length?e.pinbuilder.storyPinItems[n[0]]:{}).blockIds.length?k:M},C=[function(e){return(t,n)=>{const i=n();return new Promise(t=>{const n=Object(f.e)(i,{pinDraftId:e});let r=!1;for(let e=0;e<n.length;e+=1){var a;if(null!==(a=n[e].media)&&void 0!==a&&a.type){const{media:t}=n[e];let i;switch(t.type){case"localImage":i=t.signatureEdited;break;case"localVideo":i=void 0===t.trimmedEndTime||void 0===t.trimmedStartTime||0===t.trimmedStartTime&&t.trimmedEndTime===t.duration?t.signature:t.signatureEdited;break;case"webImage":case"webVideo":i=t.signature}if(!i){r=!0;break}}}return t(r?Object(m.b)("STORY_PIN_MEDIA_SIGNATURES_MISSING"):null)})}},function(e){return(t,n)=>{const i=n();return new Promise(t=>{const n=i.pinbuilder.pinDrafts[e].pinItemIds[0];return i.pinbuilder.storyPinItems[n].coverImgSignature?t(null):t(Object(m.b)("STORY_PIN_COVER_PAGE_SIGNATURE_MISSING"))})}}],x=(e,t)=>{const{pinItemIds:n}=e.pinbuilder.pinDrafts[t];return(n.length?e.pinbuilder.storyPinItems[n[0]]:{}).blockIds.length?C:[]};function L(e){return(t,n)=>{const i=n(),{type:r}=i.pinbuilder.pinDrafts[e],o=a()([..."story"===r?N(i,e):w].map(n=>t(n(e))));return Promise.all(o).then(e=>a()(e.filter(Boolean)))}}function B(e){return(t,n)=>{const i=n(),{type:r}=i.pinbuilder.pinDrafts[e],o=a()([..."story"===r?U(i,e):w].map(n=>t(n(e))));return Promise.all(o).then(e=>a()(e.filter(Boolean)))}}function F(e){return(t,n)=>{const i=n(),r=i.pinbuilder.pinDrafts[e],o=i.pinbuilder.storyPinItems[r.pinItemIds[0]].blockIds.length>0,s=a()([...o?x(i,e):[]].map(n=>t(n(e))));return Promise.all(s).then(e=>a()(e.filter(Boolean)))}}},lPMS:function(e,t,n){n.d(t,"l",(function(){return i})),n.d(t,"k",(function(){return r})),n.d(t,"z",(function(){return a})),n.d(t,"A",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"o",(function(){return d})),n.d(t,"m",(function(){return c})),n.d(t,"n",(function(){return l})),n.d(t,"i",(function(){return u})),n.d(t,"j",(function(){return p})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return b})),n.d(t,"f",(function(){return h})),n.d(t,"e",(function(){return _})),n.d(t,"h",(function(){return I})),n.d(t,"g",(function(){return g})),n.d(t,"K",(function(){return y})),n.d(t,"L",(function(){return O})),n.d(t,"E",(function(){return P})),n.d(t,"D",(function(){return E})),n.d(t,"B",(function(){return v})),n.d(t,"C",(function(){return j})),n.d(t,"G",(function(){return S})),n.d(t,"F",(function(){return D})),n.d(t,"I",(function(){return T})),n.d(t,"H",(function(){return w})),n.d(t,"J",(function(){return A})),n.d(t,"M",(function(){return R})),n.d(t,"N",(function(){return N})),n.d(t,"Q",(function(){return M})),n.d(t,"O",(function(){return k})),n.d(t,"P",(function(){return U})),n.d(t,"s",(function(){return C})),n.d(t,"t",(function(){return x})),n.d(t,"w",(function(){return L})),n.d(t,"u",(function(){return B})),n.d(t,"v",(function(){return F})),n.d(t,"x",(function(){return V})),n.d(t,"p",(function(){return z})),n.d(t,"r",(function(){return G})),n.d(t,"q",(function(){return H})),n.d(t,"y",(function(){return Y}));const i=600,r=64,a=600,o=150,s=1e3,d=750,c="jpeg",l=.92,u="#efefef",p=.7,m=2,f=16,b="#e60023",h=8,_="#e60023",I=1,g="white",y="#efefef",O=.7,P=2,E=8,v="#ffb3be",j=1,S=16,D="#ffb3be",T=1,w="white",A=50,R="#e60023",N="#e60023",M=4,k="black",U=58,C="#0074e8",x=.94,L=8,B="white",F="bold 16px sans-serif",V=.1,z={w:2,h:3},G=5,H={1:[{viewbox:{top:0,left:0,width:1,height:1},roundedCorners:{tl:!0,tr:!0,bl:!0,br:!0},internalEdges:{mt:!1,mb:!1,ml:!1,mr:!1}}],2:[{viewbox:{top:0,left:0,width:1,height:2/3},roundedCorners:{tl:!0,tr:!0,bl:!1,br:!1},internalEdges:{mt:!1,mb:!0,ml:!1,mr:!1},alignedSections:{mb:[]},againstSections:{mb:[1]}},{viewbox:{top:2/3,left:0,width:1,height:1/3},roundedCorners:{tl:!1,tr:!1,bl:!0,br:!0},internalEdges:{mt:!0,mb:!1,ml:!1,mr:!1},alignedSections:{mt:[]},againstSections:{mt:[0]}}],3:[{viewbox:{top:0,left:0,width:1,height:1/3},roundedCorners:{tl:!0,tr:!0,bl:!1,br:!1},internalEdges:{mt:!1,mb:!0,ml:!1,mr:!1},alignedSections:{mb:[]},againstSections:{mb:[1]}},{viewbox:{top:1/3,left:0,width:1,height:1/3},roundedCorners:{tl:!1,tr:!1,bl:!1,br:!1},internalEdges:{mt:!0,mb:!0,ml:!1,mr:!1},alignedSections:{mt:[],mb:[]},againstSections:{mt:[0],mb:[2]}},{viewbox:{top:2/3,left:0,width:1,height:1/3},roundedCorners:{tl:!1,tr:!1,bl:!0,br:!0},internalEdges:{mt:!0,mb:!1,ml:!1,mr:!1},alignedSections:{mt:[]},againstSections:{mt:[1]}}],4:[{viewbox:{top:0,left:0,width:.5,height:.5},roundedCorners:{tl:!0,tr:!1,bl:!1,br:!1},internalEdges:{mt:!1,mb:!0,ml:!1,mr:!0},alignedSections:{mb:[2],mr:[1]},againstSections:{mb:[1,3],mr:[2,3]}},{viewbox:{top:.5,left:0,width:.5,height:.5},roundedCorners:{tl:!1,tr:!1,bl:!0,br:!1},internalEdges:{mt:!0,mb:!1,ml:!1,mr:!0},alignedSections:{mt:[3],mr:[0]},againstSections:{mt:[0,2],mr:[2,3]}},{viewbox:{top:0,left:.5,width:.5,height:.5},roundedCorners:{tl:!1,tr:!0,bl:!1,br:!1},internalEdges:{mt:!1,mb:!0,ml:!0,mr:!1},alignedSections:{mb:[0],ml:[3]},againstSections:{mb:[1,3],ml:[0,1]}},{viewbox:{top:.5,left:.5,width:.5,height:.5},roundedCorners:{tl:!1,tr:!1,bl:!1,br:!0},internalEdges:{mt:!0,mb:!1,ml:!0,mr:!1},alignedSections:{mt:[1],ml:[2]},againstSections:{mt:[0,2],ml:[0,1]}}],5:[{viewbox:{top:0,left:0,width:.6,height:.5},roundedCorners:{tl:!0,tr:!1,bl:!1,br:!1},internalEdges:{mt:!1,mb:!0,ml:!1,mr:!0},alignedSections:{mb:[],mr:[1]},againstSections:{mb:[1],mr:[2,3,4]}},{viewbox:{top:.5,left:0,width:.6,height:.5},roundedCorners:{tl:!1,tr:!1,bl:!0,br:!1},internalEdges:{mt:!0,mb:!1,ml:!1,mr:!0},alignedSections:{mt:[],mr:[0]},againstSections:{mt:[0],mr:[2,3,4]}},{viewbox:{top:0,left:.6,width:.4,height:1/3},roundedCorners:{tl:!1,tr:!0,bl:!1,br:!1},internalEdges:{mt:!1,mb:!0,ml:!0,mr:!1},alignedSections:{mb:[],ml:[3,4]},againstSections:{mb:[3],ml:[0,1]}},{viewbox:{top:1/3,left:.6,width:.4,height:1/3},roundedCorners:{tl:!1,tr:!1,bl:!1,br:!1},internalEdges:{mt:!0,mb:!0,ml:!0,mr:!1},alignedSections:{mt:[],mb:[],ml:[2,4]},againstSections:{mt:[2],mb:[4],ml:[0,1]}},{viewbox:{top:2/3,left:.6,width:.4,height:1/3},roundedCorners:{tl:!1,tr:!1,bl:!1,br:!0},internalEdges:{mt:!0,mb:!1,ml:!0,mr:!1},alignedSections:{mt:[],ml:[2,3]},againstSections:{mt:[3],ml:[0,1]}}]},Y={sm:20,md:30,lg:40}},m4CH:function(e,t,n){n.d(t,"a",(function(){return r}));var i=n("IIK6");function r(e,t){const n=e/t,{carousel:r}=i.c,a=r.length,o=r[0],s=r[a-1];if(n<=s.w/s.h)return{w:e,h:t};const[d]=r.reduce((e,t,i)=>{const r=t.w/t.h,[a,o]=e,s=Math.abs(r-n);return o&&o<s?[a,o]:[t,s]},[null,null]);return{w:t*(d?d.w/d.h:o.w/o.h),h:t}}},qfnd:function(e,t,n){function i(e,t,n,i){return{type:"PIN_DRAFT_ADD_STORY_PIN_ITEM",payload:{pinDraftId:e,pinItemId:t,pinItem:n,options:i}}}n.d(t,"a",(function(){return i}))},r0wO:function(e,t,n){n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return c}));var i=n("1Naj"),r=n("Diiv");function a(e,t,n){return{type:"PIN_TAG_SET_COORDINATES",payload:{pinTagId:e,x:t,y:n}}}function o(e,t,n){return{type:"PIN_TAG_SET_LINK",payload:{pinTagId:e,link:t,error:n}}}function s(e,t){return{type:"PIN_TAG_SET_STATUS",payload:{pinTagId:e,status:t}}}function d(e,t){return(n,i)=>{const{pinbuilder:{taggedObjects:a}}=i(),{status:o}=a[t];n("created"===o?function(e,t){return{type:"PIN_TAG_REMOVE_TAGGED_OBJECT",payload:{pinTagId:e,taggedObjectId:t}}}(e,t):Object(r.a)(t,"deleted"))}}function c(e,t,n){return(r,a)=>{r(Object(i.a)(e,t,{...n,id:t,link:a().pinbuilder.pinTags[e].link})),r(o(e,""))}}},s95B:function(e,t,n){function i(e,t,n,i){return{type:"PIN_DRAFT_ADD_PIN_ITEM",payload:{pinDraftId:e,pinItemId:t,pinItem:n,options:i}}}n.d(t,"a",(function(){return i}))},y7BG:function(e,t,n){n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return p})),n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return f})),n.d(t,"e",(function(){return b}));var i=n("rh3l"),r=n("eOdZ"),a=n("8nxc"),o=n("2AUE"),s=n("HGZT"),d=n("JMvu"),c=n("IIK6"),l=n("ZQVr");function u(e){const t="string"==typeof e?e:e.src,n=(e=0)=>Object(l.i)(t).catch(t=>e<c.H?n(e+1):Promise.reject(t));return new Promise((e,t)=>{n().then(t=>function(e){const t=e.image_url,n=(e=0)=>r.a.create("StoryPinImageUploadResource",{image_url:t}).callCreate().catch(()=>e<c.H?n(e+1):Promise.reject(new Error(a.a.enabled("rename")?"Error uploading image for Idea Pin":"Error uploading image for Story Pin")));return new Promise((e,t)=>{n().then(t=>e(t.resource_response.data.image_signature)).catch(e=>t(e))})}(t).then(t=>e(t))).catch(e=>t(e))})}function p(e,t,n){return new Promise((i,r)=>{if(e.startsWith("data")){const a=Object(l.a)(e);Object(l.k)(a,"pinimage",{onFailureUpload:({failureReason:e,fileSizeBytes:i,message:r,uploadId:a})=>function({fileSizeBytes:e,pinDraftId:t,storyPageNumber:n,uploadId:i}){Object(o.a)(8785,{file_size_mb:e/Math.pow(1024,2),media_upload_id:i,story_pin_page_id:n,story_pin_upload_id:t})}({fileSizeBytes:i,pinDraftId:t,storyPageNumber:n,uploadId:a}),onFinishProcessing:({fileSizeBytes:e,processingTime:i,signature:r,uploadId:a,uploadTime:s})=>function({fileSizeBytes:e,imageSig:t,pinDraftId:n,storyPageNumber:i,uploadId:r,uploadTimeSec:a}){Object(o.a)(8781,{file_size_mb:e/Math.pow(1024,2),image_signature:t,media_upload_id:r,story_pin_page_id:i,story_pin_upload_id:n,upload_time:a})}({fileSizeBytes:e,imageSig:r,pinDraftId:t,storyPageNumber:n,uploadId:a,uploadTimeSec:s+i}),onStartUpload:({fileSizeBytes:e,uploadId:i})=>function({fileSizeBytes:e,pinDraftId:t,storyPageNumber:n,uploadId:i}){Object(o.a)(8780,{file_size_mb:e/Math.pow(1024,2),media_upload_id:i,story_pin_page_id:n,story_pin_upload_id:t})}({fileSizeBytes:e,pinDraftId:t,storyPageNumber:n,uploadId:i})}).then(({signature:e,uploadId:t})=>i({uploadId:t,signature:e||""})).catch(e=>{r(e)})}else r(new Error("Image must be of b64 format"))})}function m(e,t,n,i,r){return Object(s.a)(e,t,r).then(e=>p(e.src,n,i))}function f(e,t,n,i,r){const a=e.find(e=>!!e.media&&["localImage","localVideo"].includes(e.media.type)),{edits:o,media:c}=a||{};if(!a||!c)return Promise.resolve({signature:"",uploadId:""});const u=e.find(e=>"story_pin_paragraph_block"===e.type),m=u?{...u,font:n.find(e=>{var t;return e.id===String(null===(t=u.style)||void 0===t?void 0:t.font_id)})||n[0]}:void 0;return new Promise(e=>{"localVideo"===c.type?Object(d.b)(c,c.thumbnail||0).then(t=>{e({height:c.height,id:`${c.id}-${c.thumbnail}`,name:c.name+"-coverImg",size:Object(l.a)(t).size,src:t,type:"localImage",width:c.width})}):"localImage"===c.type&&e(c)}).then(e=>Object(s.a)(e,o,r,m,t,!0)).then(e=>p(e.src,i,0))}function b(e,t=0){return new Promise((n,a)=>{const{linkBlock:o}=e,{imageUrl:s}=o;r.a.create("StoryPinImageUploadResource",{image_url:s}).callCreate().then(e=>e.resource_response.data.image_signature).catch(()=>t<c.H?b(e,t+1):(i.default.logToServer(i.default.SERVER_LOG_TYPE.ERROR,i.default.HTTP_METHOD.POST,{errorObj:{name:"React PinBuilder Resource Error",message:"Error uploading Link Box image for Story Pin"},auxData:{imageUrl:s}}),"")).then(e=>{n({...o,imageSignature:e})})})}},yRuA:function(e,t,n){n.d(t,"a",(function(){return O}));var i=n("7w6Q"),r=n("eOdZ"),a=n("Ye/N"),o=n("qpbZ");const s=[200,201,204];async function d(e,t,n,i,r,d){const{upload_id:c,upload_parameters:l,upload_url:u}=r;null==d||d.addSubspan({name:t+"_page_publish",startTime:performance.now(),id:c});const{onFailure:p,onFinishUpload:m,onStartUpload:f,onUploadProgress:b}=i;f&&f(c);const h=new Date,_=new XMLHttpRequest;_.open("POST",u,!0),_.onload=()=>{if(s.includes(_.status)){if(m){const e=(new Date-h)/1e3,t=_.getResponseHeader("x-amz-request-id"),n=_.getResponseHeader("x-amz-id-2");m(c,{amzId2:n,amzRequestId:t,uploadTimeSec:e,statusCode:_.status})}}else{const e="image"===t?1:8,n=Object(o.b)(a.a._("Failed to upload the media with XHR status code: {{ status }}","uploadMediaVIP.onLoad.errorMessage","Error message sent to notify upload failure."),{status:_.status}).join("");p({uploadId:c,errorMsg:n,mediaUploadFailureReason:e,retry:!0})}},_.onerror=()=>{const e="image"===t?1:8,n=a.a._("Failed to upload the media","uploadMediaVIP.onError.errorMessage","Error message sent to notify upload failure.");p({uploadId:c,errorMsg:n,mediaUploadFailureReason:e,retry:!0})},b&&(_.upload.onprogress=e=>{b(Math.round(e.loaded/e.total*100))});const I=new FormData;return Object.keys(l).forEach(e=>{I.append(e,l[e])}),I.append("file",e),_.send(I),{uploadId:c,xhr:_}}var c=n("7Cbv"),l=n("ZQVr");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p=["webImage","webVideo"];class m{constructor(e){u(this,"upload",()=>{}),u(this,"onFailure",({errorMsg:e,mediaUploadFailureReason:t,retry:n,uploadId:i})=>{n&&this.numAttempts<this.maxUploadAttempts?this.upload():(this.status="failed",this.callbackHandlers.onFailure({errorMsg:e,mediaUploadFailureReason:t,uploadId:i,storyPinPublishStopwatch:this.storyPinPublishStopwatch}))}),u(this,"onFinishProcessing",(e,t)=>{this.signature=t.signature,this.callbackHandlers.onFinishProcessing&&this.callbackHandlers.onFinishProcessing(e,t,this.storyPinPublishStopwatch)}),u(this,"onFinishUpload",(e,t)=>{this.status="uploaded",this.callbackHandlers.onFinishUpload&&this.callbackHandlers.onFinishUpload(e,t,this.storyPinPublishStopwatch)}),u(this,"onStartProcessing",(e,t)=>{this.signature=t.signature,this.callbackHandlers.onStartProcessing&&this.callbackHandlers.onStartProcessing(e,t,this.storyPinPublishStopwatch)}),u(this,"cancel",()=>{this.xhr&&(this.xhr.abort(),this.callbackHandlers.onCancel&&this.callbackHandlers.onCancel(this.uploadId||"",this.storyPinPublishStopwatch))}),this.media=e.media,this.vipType=e.vipType,this.maxUploadAttempts=e.maxUploadAttempts||1,this.numAttempts=0,this.storyPinPublishStopwatch=e.storyPinPublishStopwatch,this.vipRegistration=e.vipRegistration,this.callbackHandlers=e.callbackHandlers}}class f extends m{constructor(e){super(e),u(this,"getClassName",()=>"ImageUpload"),u(this,"onProcessingFailed",e=>{this.uploadId&&this.onFailure({uploadId:this.uploadId,errorMsg:`Failed to process image with uploadId ${this.uploadId} and failureCode ${e}`,mediaUploadFailureReason:3,mediaStatusFailureReason:e})}),u(this,"onProcessingTimeout",()=>{this.uploadId&&this.onFailure({uploadId:this.uploadId,errorMsg:"Timed out on processing video with uploadId "+this.uploadId,mediaUploadFailureReason:4})}),u(this,"upload",()=>{"localImage"===this.media.type&&(this.numAttempts+=1,d(Object(l.a)(this.media.src),"image",this.vipType,{onFailure:this.onFailure,onFinishUpload:this.onFinishUpload,onStartUpload:this.callbackHandlers.onStartUpload,onUploadProgress:this.callbackHandlers.onUploadProgress},this.vipRegistration,this.storyPinPublishStopwatch).then(e=>{this.uploadId=e.uploadId,this.xhr=e.xhr,this.status="uploading"}))}),this.signature=p.includes(e.media.type)?e.media.signature:null,this.status=p.includes(e.media.type)?"uploaded":"pending"}}class b extends m{constructor(e){super(e),u(this,"getClassName",()=>"VideoUpload"),u(this,"onProcessingFailed",e=>{this.uploadId&&this.onFailure({uploadId:this.uploadId,errorMsg:`Failed to process video with uploadId ${this.uploadId} and failureCode ${e}`,mediaUploadFailureReason:10,mediaStatusFailureReason:e,storyPinPublishStopwatch:this.storyPinPublishStopwatch})}),u(this,"onProcessingTimeout",()=>{this.uploadId&&this.onFailure({uploadId:this.uploadId,errorMsg:"Timed out on processing video with uploadId "+this.uploadId,mediaUploadFailureReason:11,storyPinPublishStopwatch:this.storyPinPublishStopwatch})}),u(this,"upload",()=>{"localVideo"===this.media.type&&(this.numAttempts+=1,d(this.media.fileSrc,"video",this.vipType,{onFailure:this.onFailure,onFinishUpload:this.onFinishUpload,onStartUpload:this.callbackHandlers.onStartUpload,onUploadProgress:this.callbackHandlers.onUploadProgress},this.vipRegistration,this.storyPinPublishStopwatch).then(e=>{this.uploadId=e.uploadId,this.xhr=e.xhr,this.status="uploading"}))}),this.signature=p.includes(e.media.type)?e.media.signature:null,this.status=p.includes(e.media.type)?"uploaded":"pending"}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _=3e3;class I{constructor(e){var t=this;h(this,"getMediaRegistrationsFromVIP",(async function(e,n=20){var a;const o=[];for(;n>0;)o.push({id:Object(c.a)(),media_type:"image"===e?"image-story-pin":"video-story-pin"}),n-=1;return null===(a=t.storyPinPublishStopwatch)||void 0===a||a.subspanStart({name:e+"_registration",id:`${e}_registration_${n}`}),r.a.create("ApiResource",{url:"/v3/media/uploads/register/batch/",data:{media_info_list:JSON.stringify(o)}}).callCreate({showError:3===t.vipRegistrationPool[e].retries}).then(i=>{var r,a;const o="object"==typeof(null===(r=i.resource_response)||void 0===r?void 0:r.data)?Object.values(i.resource_response.data):[];t.vipRegistrationPool[e]={fetchedLast:performance.now(),retries:0,data:o},null===(a=t.storyPinPublishStopwatch)||void 0===a||a.subspanStop({name:e+"_registration",id:`${e}_registration_${n}`})},r=>{var a;i.a.increment(`storypin.publish.registration.${e}.failure`,1,{reason:r.message,retryCount:t.vipRegistrationPool[e].retries}),t.vipRegistrationPool[e].retries<3?(t.inDebugMode&&console.log(`${e} registration failed. ${3-t.vipRegistrationPool[e].retries} retries remaining`,r),t.vipRegistrationPool[e].retries+=1,t.getMediaRegistrationsFromVIP(e)):(t.inDebugMode&&console.log(e+" registration failed.",r),t.onFailure("Failed to register upload with message: "+r,13)),null===(a=t.storyPinPublishStopwatch)||void 0===a||a.subspanStop({name:e+"_registration",id:`${e}_registration_${n}`})})})),h(this,"initVIPRegistrationPools",()=>{this.getMediaRegistrationsFromVIP("image"),this.getMediaRegistrationsFromVIP("video")}),h(this,"checkAllUploadsProcessingOrCompleted",()=>{let e=0;const t=Object.keys(this.mediaUploadsMap);for(const n of t){const t=this.mediaUploadsMap[n];this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Status of media upload ID",n,t.mediaUpload.getClassName(),t.status),("completed"===t.status||"processing"===t.status&&"VideoUpload"===t.mediaUpload.getClassName())&&(e+=1)}return this.inDebugMode&&(console.log("[MEDIA UPLOAD MANAGER] - Checking if all upload processes completed"),console.log("Number of completed uploads:",e)),e===Object.keys(this.mediaUploadsMap).length}),h(this,"checkUploadsFailed",()=>!!Object.keys(this.mediaUploadsMap).find(e=>"failed"===this.mediaUploadsMap[e].status)),h(this,"updateUploadStatus",(e,t)=>this.mediaUploadsMap[e].status=t),h(this,"updateVIPStatusMap",e=>{const t=new Date;for(const n of Object.keys(e)){const{failureCode:i,signature:r,status:a}=e[n];if(n in this.vipStatusMap){const e=this.vipStatusMap[n].mediaId,o=this.mediaUploadsMap[e];if(i){o.mediaUpload.onProcessingFailed(i),this.updateUploadStatus(e,"failed");break}if(this.vipStatusMap[n].status!==a){if(this.vipStatusMap[n]={...this.vipStatusMap[n],status:a,timeSet:t},"processing"===a)o.mediaUpload.onStartProcessing(n,{signature:r}),this.updateUploadStatus(e,"processing");else if("succeeded"===a){const i=(t-this.vipStatusMap[n].timeSet)/1e3;o.mediaUpload.onFinishProcessing(n,{processingTimeSec:i,signature:r}),this.updateUploadStatus(e,"completed")}}else this.statusTimeoutMap[a]&&(t-this.vipStatusMap[n].timeSet)/1e3>=this.statusTimeoutMap[a].timeoutSec&&(o.mediaUpload.onProcessingTimeout(),this.statusTimeoutMap[a].onTimeout())}}}),h(this,"getMediaRegistration",(async function(e){if(t.vipRegistrationPool[e]){const n=performance.now()-t.vipRegistrationPool[e].fetchedLast>=18e5;(0===t.vipRegistrationPool[e].data.length||n)&&await t.getMediaRegistrationsFromVIP(e)}else await t.getMediaRegistrationsFromVIP(e);return Promise.resolve(t.vipRegistrationPool[e].data.pop())})),h(this,"handleFailure",(e,t)=>{this.failed||(this.onFailure(e,t),this.failed=!0)}),h(this,"handleCheckUploadsCompleted",()=>{const e=this.checkAllUploadsProcessingOrCompleted();return e&&this.onCompleted&&!this.completed&&(this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - All uploads have completed & we are triggering the onCompleted callback"),this.completed=!0,this.onCompleted()),e}),h(this,"onFinishUpload",(e,t)=>{this.vipStatusMap[e]={mediaId:t,status:null,timeSet:new Date},this.updateUploadStatus(t,"uploaded"),this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Finished uploading media ID",t),this.checkingStatus||(this.checkingStatus=!0,setTimeout(()=>this.checkStatus(),_))}),h(this,"onUploadFailed",(e,t,n)=>{this.updateUploadStatus(e,"failed"),this.handleFailure(t,n),this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Failed uploading media ID",e)}),h(this,"removeMediaUpload",e=>{this.mediaUploadsMap[e]&&(this.mediaUploadsMap[e].mediaUpload.cancel(),delete this.mediaUploadsMap[e])}),h(this,"addMediaUpload",(e,t,n,i)=>{const r="localImage"===e.type||"webImage"===e.type?"image":"video";this.getMediaRegistration(r).then(n=>{const r={...i,onFailure:({uploadId:e,errorMsg:n,mediaUploadFailureReason:r})=>{this.onUploadFailed(t,n,r),i.onFailure({uploadId:e,errorMsg:n,mediaUploadFailureReason:r})},onFinishUpload:(e,n)=>{this.onFinishUpload(e,t),i.onFinishUpload&&i.onFinishUpload(e,n)}},a="localImage"===e.type||"webImage"===e.type?new f({callbackHandlers:r,media:e,maxUploadAttempts:this.maxMediaUploadAttempts,vipType:"image-story-pin",storyPinPublishStopwatch:this.storyPinPublishStopwatch,vipRegistration:n}):new b({callbackHandlers:r,media:e,maxUploadAttempts:this.maxMediaUploadAttempts,vipType:"video-story-pin",storyPinPublishStopwatch:this.storyPinPublishStopwatch,vipRegistration:n});if(this.mediaUploadsMap[t]){this.mediaUploadsMap[t].mediaUpload.cancel();const{uploadId:e}=this.mediaUploadsMap[t].mediaUpload;e&&e in this.vipStatusMap&&delete this.vipStatusMap[e]}this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Added media ID to upload",t),this.mediaUploadsMap[t]={mediaUpload:a,status:"pending"},a.upload(),this.updateUploadStatus(t,"uploading")})}),h(this,"reset",()=>{this.failed=!1,this.statusCheckFailureCount=0,this.completed=!1}),h(this,"cancelAll",()=>{for(const e of Object.keys(this.mediaUploadsMap))"uploading"===this.mediaUploadsMap[e].status&&this.mediaUploadsMap[e].mediaUpload.cancel()}),h(this,"checkStatus",()=>{if(this.checkUploadsFailed())return this.checkingStatus=!1,void(this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] There is a failure in check status",this.vipStatusMap));this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Checking status",this.vipStatusMap),this.checkingStatus=!0;(async function(e,t){try{const n=await r.a.create("VIPResource",{upload_ids:e}).callGet(),{data:a}=n.resource_response;return e.reduce((e,n)=>(a[n]?e[n]={failureCode:a[n].failure_code,signature:a[n].signature,status:a[n].status}:i.a.increment("storypin.publish.vip_status_check.missing_upload_id",1,{retryCount:t}),e),{})}catch(n){throw n}})(Object.keys(this.vipStatusMap),this.statusCheckFailureCount).then(e=>{this.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Check status response received",this.vipStatusMap),this.updateVIPStatusMap(e);const t=this.handleCheckUploadsCompleted(),n=Object.keys(this.vipStatusMap);for(const r of n){const e=this.vipStatusMap[r].mediaId;this.mediaUploadsMap[e]?"completed"===this.mediaUploadsMap[e].status&&delete this.vipStatusMap[r]:i.a.increment("storypin.publish.media_uploads_map.missing_upload_id",1,{retryCount:this.statusCheckFailureCount,mediaId:e,vipId:r})}Object.keys(this.vipStatusMap).length>0&&!t?setTimeout(()=>this.checkStatus(),_):this.checkingStatus=!1}).catch(e=>{this.statusCheckFailureCount+=1,this.statusCheckFailureCount>4?(this.inDebugMode&&console.log(`[MEDIA UPLOAD MANAGER] - Failing upload because status check failed ${this.statusCheckFailureCount} times`),this.handleFailure(`Could not check VIP status with error: ${null==e?void 0:e.name} ${null==e?void 0:e.message}`,14),this.checkingStatus=!1):(this.inDebugMode&&console.log(`[MEDIA UPLOAD MANAGER] - Continuing upload because status check only failed ${this.statusCheckFailureCount} times`),setTimeout(()=>this.checkStatus(),_))})}),this.onCancel=e.onCancel,this.onCompleted=e.onCompleted||null,this.onFailure=e.onFailure,this.statusTimeoutMap=e.statusTimeoutMap,this.maxMediaUploadAttempts=e.maxMediaUploadAttempts,this.inDebugMode=e.inDebugMode,this.storyPinPublishStopwatch=e.storyPinPublishStopwatch,this.checkingStatus=!1,this.completed=!1,this.failed=!1,this.vipRegistrationPool={image:{fetchedLast:0,retries:0,data:[]},video:{fetchedLast:0,retries:0,data:[]}},this.statusCheckFailureCount=0,this.mediaUploadsMap={},this.vipStatusMap={}}}var g=n("fDVu"),y=n("i+W5");function O(e,t){return(n,i)=>{const{viewer:r}=i(),a=new I({inDebugMode:r.isAuth&&r.isEmployee,maxMediaUploadAttempts:g.a,onCancel:()=>{},onFailure:()=>{},statusTimeoutMap:{registered:{onTimeout:()=>{},timeoutSec:60},processing:{onTimeout:()=>{},timeoutSec:300}},storyPinPublishStopwatch:t});a.initVIPRegistrationPools(),n(Object(y.P)(e,a))}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/116-d5c872df18597798fd35.mjs.map